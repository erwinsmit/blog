4:"$Sreact.fragment"
5:I[231,["231","static/chunks/231-c96e92b4cbbab7e2.js","404","static/chunks/app/blog/page-19199c8b99a973b9.js"],""]
6:I[9275,[],""]
7:I[1343,[],""]
8:I[5442,["231","static/chunks/231-c96e92b4cbbab7e2.js","160","static/chunks/app/not-found-84a7f5eea0d523d6.js"],"default"]
a:I[3120,[],"OutletBoundary"]
c:I[3120,[],"MetadataBoundary"]
e:I[3120,[],"ViewportBoundary"]
10:I[6130,[],""]
1:HL["/_next/static/media/a34f9d1faa5f3315-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
2:HL["/_next/static/css/3e1713d87a54c95d.css","style"]
3:HL["/_next/static/css/3a398bc4ce4edcc7.css","style"]
0:{"P":null,"b":"cQgPgh7DVgYY_dMh6Hf_e","p":"","c":["","blog","block-automatically-generated-domain-azure-swa"],"i":false,"f":[[["",{"children":["blog",{"children":[["slug","block-automatically-generated-domain-azure-swa","d"],{"children":["__PAGE__?{\"slug\":\"block-automatically-generated-domain-azure-swa\"}",{}]}]}]},"$undefined","$undefined",true],["",["$","$4","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3e1713d87a54c95d.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"rel":"apple-touch-icon","sizes":"180x180","href":"/favicon/apple-touch-icon.png"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"32x32","href":"/favicon/favicon-32x32.png"}],["$","link",null,{"rel":"icon","type":"image/png","sizes":"16x16","href":"/favicon/favicon-16x16.png"}],["$","link",null,{"rel":"manifest","href":"/favicon/site.webmanifest"}],["$","link",null,{"rel":"mask-icon","href":"/favicon/safari-pinned-tab.svg","color":"#000000"}],["$","link",null,{"rel":"shortcut icon","href":"/favicon/favicon.ico"}],["$","meta",null,{"name":"msapplication-TileColor","content":"#000000"}],["$","meta",null,{"name":"msapplication-config","content":"/favicon/browserconfig.xml"}],["$","meta",null,{"name":"theme-color","content":"#000"}],["$","link",null,{"rel":"alternate","type":"application/rss+xml","href":"/feed.xml"}]]}],["$","body",null,{"className":"bg-gray-100 ","children":[["$","header",null,{"className":"bg-blue-600 text-white shadow-md","children":["$","div",null,{"className":"container mx-auto px-4 py-6","children":["$","nav",null,{"children":["$","ul",null,{"className":"flex justify-center space-x-6","children":[["$","li",null,{"children":["$","$L5",null,{"href":"/","className":"hover:text-blue-200 transition duration-150 ease-in-out","children":"About me"}]}],["$","li",null,{"children":["$","$L5",null,{"href":"/blog","className":"hover:text-blue-200 transition duration-150 ease-in-out","children":"Blog"}]}]]}]}]}]}],["$","main",null,{"className":"min-h-screen","children":["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","$L8",null,{}],"notFoundStyles":[]}]}],["$","section",null,{"className":"bg-gray-800 text-white py-12","children":["$","div",null,{"className":"container mx-auto px-4 text-center","children":[["$","h2",null,{"className":"text-2xl font-bold mb-6","children":"Connect With Me"}],["$","div",null,{"className":"flex justify-center space-x-6","children":[["$","a",null,{"href":"https://github.com/erwinsmit","target":"_blank","rel":"noopener noreferrer","className":"hover:text-blue-400 transition-colors","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":32,"height":32,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-github","children":[["$","path","tonef",{"d":"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"}],["$","path","9comsn",{"d":"M9 18c-4.51 2-5-2-7-2"}],"$undefined"]}],["$","span",null,{"className":"sr-only","children":"GitHub"}]]}],["$","a",null,{"href":"https://www.linkedin.com/in/erwin-smit-40957840/","target":"_blank","rel":"noopener noreferrer","className":"hover:text-blue-400 transition-colors","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":32,"height":32,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-linkedin","children":[["$","path","c2jq9f",{"d":"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"}],["$","rect","mk3on5",{"width":"4","height":"12","x":"2","y":"9"}],["$","circle","bt5ra8",{"cx":"4","cy":"4","r":"2"}],"$undefined"]}],["$","span",null,{"className":"sr-only","children":"LinkedIn"}]]}]]}]]}]}]]}]]}]]}],{"children":["blog",["$","$4","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":[["slug","block-automatically-generated-domain-azure-swa","d"],["$","$4","c",{"children":[null,["$","$L6",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L7",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]]}],{"children":["__PAGE__",["$","$4","c",{"children":["$L9",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/3a398bc4ce4edcc7.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","$La",null,{"children":"$Lb"}]]}],{},null]},null]},null]},null],["$","$4","h",{"children":[null,["$","$4","06dDqdFklQ17sO-WnRJ4w",{"children":[["$","$Lc",null,{"children":"$Ld"}],["$","$Le",null,{"children":"$Lf"}],["$","meta",null,{"name":"next-size-adjust"}]]}]]}]]],"m":"$undefined","G":["$10","$undefined"],"s":false,"S":true}
9:["$","article",null,{"className":"max-w-7xl mx-auto px-8 my-12","children":[["$","h1",null,{"className":"w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font","children":["$","span",null,{"className":"bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500","children":"Block generated domains by Azure Static Web Apps"}]}],["$","div",null,{"className":"flex items-center justify-center mb-16","children":["$","p",null,{"className":"text-base font-medium text-gray-600 group-hover:text-gray-800","children":["$","time",null,{"dateTime":"2023-02-22","children":"February\t22, 2023"}]}]}],["$","div",null,{"className":"prose lg:prose-xl max-w-none prose-pre:p-0","children":[["$","p","p-0",{"children":["Please note: This post applies for ",["$","a","a-0",{"href":"https://learn.microsoft.com/en-us/azure/static-web-apps/deploy-nextjs-hybrid","children":"Hybrid Next.js Azure Static Web Apps"}]]}],"\n",["$","p","p-1",{"children":["Azure Static Web Apps automatically creates a domain like ",["$","code","code-0",{"children":"blue-river-096abc21e.2.azurestaticapps.net"}],". Even when you have created a custom domain for your Azure Static Web App it's not possible to ",["$","a","a-0",{"href":"https://techcommunity.microsoft.com/t5/apps-on-azure/is-it-possible-to-disable-the-default-url-assigned-to-the-azure/m-p/2017272","children":"disable or block this domain"}],"."]}],"\n",["$","p","p-2",{"children":["In a current ",["$","strong","strong-0",{"children":"Sitecore JSS Next.js"}]," project we are applying IP restrictions on our custom domains, but these automatically generated URLs can't be blocked using Web Application Firewall or Azure Frontdoor. So how do we make sure these URLs are not publicly accessible?"]}],"\n",["$","p","p-3",{"children":["Luckily with Next.js you can use ",["$","a","a-0",{"href":"https://nextjs.org/docs/advanced-features/middleware","children":"middleware"}]," for a while now. So my idea was to apply a redirect to the custom domain when I detect a ",["$","code","code-0",{"children":".azurestaticapps"}]," host header. But, when you inspect all the headers on a request, no host header was present when an ",["$","a","a-1",{"href":"https://github.com/Azure/static-web-apps/issues/1012","children":"azurestaticapps.net domain is used"}],"."]}],"\n",["$","p","p-4",{"children":"When you access the site using a custom domain, you DO get a header with the hostname in it. Using that you can create a redirect with a few lines of code in your _middleware.ts file:"}],"\n",["$","pre","pre-0",{"children":["$","code","code-0",{"className":"hljs language-javascript","children":[["$","span","span-0",{"className":"hljs-keyword","children":"const"}]," host = req.",["$","span","span-1",{"className":"hljs-property","children":"headers"}],".",["$","span","span-2",{"className":"hljs-title function_","children":"get"}],"(",["$","span","span-3",{"className":"hljs-string","children":"'x-forwarded-host'"}],");\n\n",["$","span","span-4",{"className":"hljs-keyword","children":"const"}]," blockedHostRedirect = process.",["$","span","span-5",{"className":"hljs-property","children":"env"}],".",["$","span","span-6",{"className":"hljs-property","children":"BLOCKED_HOST_REDIRECT"}]," || ",["$","span","span-7",{"className":"hljs-string","children":"'https://www.erwinsmit.com'"}],";\n\n",["$","span","span-8",{"className":"hljs-comment","children":"// When x-forwarded-host header is not set, a default URL is used (e.g. blue-river-096abc21e.2.azurestaticapps.net)"}],"\n",["$","span","span-9",{"className":"hljs-comment","children":"// so redirect to blockedHostRedirect"}],"\n",["$","span","span-10",{"className":"hljs-keyword","children":"if"}]," (!host && process.",["$","span","span-11",{"className":"hljs-property","children":"env"}],".",["$","span","span-12",{"className":"hljs-property","children":"BLOCK_SWA_DEFAULT_HOST"}],") {\n    ",["$","span","span-13",{"className":"hljs-keyword","children":"return"}]," ",["$","span","span-14",{"className":"hljs-title class_","children":"NextResponse"}],".",["$","span","span-15",{"className":"hljs-title function_","children":"redirect"}],"(blockedHostRedirect);\n}\n"]}]}],"\n",["$","p","p-5",{"children":["I like to switch features on or off using environment variables, ",["$","code","code-0",{"children":"process.env.BLOCK_SWA_DEFAULT_HOST"}]," is used to switch the redirect on or off.\n",["$","code","code-1",{"children":"process.env.BLOCKED_HOST_REDIRECT"}]," is used for specifying a domain it should redirect to."]}],"\n",["$","p","p-6",{"children":"There you go, using Nextjs middelware it is possible to block access to the automatically generated URLs."}]]}]]}]
f:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
d:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"Block generated domains by Azure Static Web Apps"}],["$","meta","2",{"name":"description","content":"Erwin Smit - Freelance frontend developer / fullstack developer"}],["$","meta","3",{"property":"og:title","content":"Block generated domains by Azure Static Web Apps"}],["$","meta","4",{"property":"og:description","content":"Erwin Smit - Freelance frontend developer / fullstack developer"}],["$","meta","5",{"name":"twitter:card","content":"summary"}],["$","meta","6",{"name":"twitter:title","content":"Block generated domains by Azure Static Web Apps"}],["$","meta","7",{"name":"twitter:description","content":"Erwin Smit - Freelance frontend developer / fullstack developer"}]]
b:null
