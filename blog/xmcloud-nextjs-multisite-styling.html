<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/0f5f8cc0eb7d6afc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3a398bc4ce4edcc7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8af1d2e0ff41d756.js"/><script src="/_next/static/chunks/4bd1b696-05ac3765304a89c0.js" async=""></script><script src="/_next/static/chunks/215-c1a7d2d931604563.js" async=""></script><script src="/_next/static/chunks/main-app-e5edefe120089e16.js" async=""></script><script src="/_next/static/chunks/231-015614b9a59ae6eb.js" async=""></script><script src="/_next/static/chunks/173-e6c8bf506bfb93ff.js" async=""></script><script src="/_next/static/chunks/app/layout-28f46ae9c6a8b2dc.js" async=""></script><script src="/_next/static/chunks/app/not-found-081a5836cd82c2ca.js" async=""></script><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><title>Sitecore XM Cloud multisite styling</title><meta name="description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta property="og:title" content="Sitecore XM Cloud multisite styling"/><meta property="og:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Sitecore XM Cloud multisite styling"/><meta name="twitter:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="bg-gray-100 [object Object]"><header class="bg-blue-600 text-white shadow-md"><div class="container mx-auto px-4 py-4"><div class="flex justify-between items-center"><a href="/"><div class="flex items-center space-x-4 bg-blue-700 rounded-full py-2 px-4"><img alt="Erwin Smit" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" class="rounded-full border-2 border-white" style="color:transparent;height:40px;width:40px;object-fit:cover" src="/assets/selfie2.jpg"/><span class="font-semibold text-lg text-white">Erwin Smit</span></div></a><nav class="flex-grow"><ul class="flex justify-end space-x-6"><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/">About me</a></li><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/blog">Blog</a></li></ul></nav></div></div></header><main class="min-h-screen"><article class="max-w-7xl mx-auto px-8 my-12"><h1 class="w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font"><span class="bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500">Sitecore XM Cloud multisite styling</span></h1><div class="flex items-center justify-center mb-16"><p class="text-base font-medium text-gray-600 group-hover:text-gray-800"><time dateTime="2024-01-17">January	17, 2024</time></p></div><div class="prose lg:prose-xl max-w-none prose-pre:p-0"><p>I started working on an interesting Sitecore headless project, so it&#x27;s time to start blogging about my findings again!
Currently, I&#x27;m working on a project where a SXA multisite setup is migrated to XM Cloud.</p>
<p>Handling the multisite setup is now very easy thanks to the <a href="https://doc.sitecore.com/xp/en/developers/hd/21/sitecore-headless-development/the-next-js-multisite-add-on.html">multisite Next.js addon</a> provided by the JSS team.</p>
<p>However, one thing I can&#x27;t find in the documentation, how do you use a specific stylesheet for each SXA site?
We are leaving the styling as-is, so I want to load the existing SCSS files into Next.js.</p>
<p>In Next.js you can add your SCSS to the application with a simple import:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;scss/styles.scss&#x27;</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, pageProps }: AppProps&lt;SitecorePageProps&gt;</span>): <span class="hljs-variable constant_">JSX</span>.<span class="hljs-property">Element</span> {
  <span class="hljs-keyword">const</span> { dictionary, ...rest } = pageProps;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">I18nProvider</span> <span class="hljs-attr">lngDict</span>=<span class="hljs-string">{dictionary}</span> <span class="hljs-attr">locale</span>=<span class="hljs-string">{pageProps.locale}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Component</span> {<span class="hljs-attr">...rest</span>} /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">I18nProvider</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>The problem I have here, you only know which site you are on <strong>within</strong> the App function. And within the App function, it&#x27;s not possible to import SCSS. With a couple of steps, I have worked around this.</p>
<h2>1. Build your SCSS yourself</h2>
<p>Instead of using Next.js to build the SCSS, setup a webpack file yourself:</p>
<pre><code class="hljs language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">entry</span>: {
        <span class="hljs-attr">siteA</span>: [<span class="hljs-string">&#x27;./scss/siteA/main.scss&#x27;</span>],
        <span class="hljs-attr">siteB</span>: [<span class="hljs-string">&#x27;./scss/siteB/main.scss&#x27;</span>],
    },
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public/static&#x27;</span>),     
    },
    <span class="hljs-attr">module</span>: {
        <span class="hljs-attr">rules</span>: [
            {
                <span class="hljs-comment">// Using MiniCssExtractPlugin to write the output to its own file.</span>
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.scss$/</span>,
                <span class="hljs-attr">use</span>: [
                    {
                        <span class="hljs-attr">loader</span>: <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>,
                    },
                    {
                        <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;css-loader&#x27;</span>,
                        <span class="hljs-attr">options</span>: {
                            <span class="hljs-attr">importLoaders</span>: <span class="hljs-number">2</span>
                        }
                    },
                    {
                        <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;postcss-loader&#x27;</span>,
                    },
                    {
                        <span class="hljs-attr">loader</span>: <span class="hljs-string">&#x27;sass-loader&#x27;</span>,
                        <span class="hljs-attr">options</span>: {
                            <span class="hljs-attr">implementation</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;sass&quot;</span>),
                        }
                    }
                ]
            },
            
        ]
    },
    <span class="hljs-attr">plugins</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
            <span class="hljs-attr">filename</span>: <span class="hljs-function">(<span class="hljs-params">{ chunk }</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${chunk.name.replace(<span class="hljs-string">&#x27;/js/&#x27;</span>, <span class="hljs-string">&#x27;/css/&#x27;</span>)}</span>.css`</span>,
        })
    ]
</code></pre>
<p>Now add the following tasks to your package.json:</p>
<pre><code class="hljs language-json"><span class="hljs-attr">&quot;build:scss&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rimraf public/static &amp;&amp; webpack --config webpack.scss.config.js --mode production&quot;</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">&quot;scss:watch&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rimraf public/static &amp;&amp; webpack --config webpack.scss.config.js --mode development --watch&quot;</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>Add the watch and build tasks to the existing start and build scripts so they are run during development and build:</p>
<pre><code class="hljs language-json"><span class="hljs-attr">&quot;build&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npm-run-all --serial bootstrap next:build build:scss&quot;</span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">&quot;start:connected&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;npm-run-all --serial bootstrap --parallel next:dev start:watch-components scss:watch&quot;</span><span class="hljs-punctuation">,</span>    
</code></pre>
<p>As you notice I am using the <code>public/static</code> directory for build assets, so it&#x27;s a good idea to add <code>public/static</code> to your .gitignore file and remove the directory on each build (using <a href="https://www.npmjs.com/package/rimraf">rimraf</a> in the example).</p>
<p>In the <code>_app.tsx</code> you can now refer to the correct stylesheet based on the SXA site:</p>
<pre><code class="hljs language-javascript"><span class="hljs-comment">/* eslint-disable @next/next/no-css-tags */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, pageProps }: AppProps&lt;SitecorePageProps&gt;</span>): <span class="hljs-variable constant_">JSX</span>.<span class="hljs-property">Element</span> {
  <span class="hljs-keyword">const</span> { dictionary, ...rest } = pageProps;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">static</span>/${(<span class="hljs-attr">pageProps.site.name</span>)}<span class="hljs-attr">.css</span>`} /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>
</span></code></pre>
<p>I added the <code>/* eslint-disable @next/next/no-css-tags */</code> line because <a href="https://nextjs.org/docs/messages/no-css-tags">Next.js doesn&#x27;t like it</a> when you add CSS with a regular stylesheet link. I think this is silly, we have been adding stylesheets this way for 20 years. So I have no problem using this eslint-disable line. I&#x27;m also not seeing any performance concerns here.</p>
<h2>2. What about caching?</h2>
<p>By default the public directory from Next.js does not cache, see my <a href="https://www.erwinsmit.com/caching-nextjs-public-directory/">previous blog post</a> on how to resolve that. How do you make sure users don&#x27;t see a stale version when new CSS is deployed?</p>
<p>First, I tried to use the <code>BUILD_ID</code> (located in the .next directory) from Next as a prefix to the CSS path. However, that can&#x27;t be accessed on build-time because the <code>BUILD_ID</code> is not generated until the build is actually complete.</p>
<p>So instead, I decided to use the current <strong>commit hash</strong>, meaning that with each build there will automatically be a fresh CSS file with a long cache-header.</p>
<p>First, create a script that returns a short version of the commit hash:</p>
<p><strong>getCommitHash.js</strong></p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> getCommitHash = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> (
        <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;child_process&#x27;</span>)
        .<span class="hljs-title function_">execSync</span>(<span class="hljs-string">&#x27;git log --pretty=format:&quot;%h&quot; -n1&#x27;</span>)
        .<span class="hljs-title function_">toString</span>()
        .<span class="hljs-title function_">trim</span>()
    );
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = getCommitHash;
</code></pre>
<p>In the webpack config responsible for building the CSS, place the CSS files in a path containing the commit hash:</p>
<pre><code class="hljs language-javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
    <span class="hljs-attr">entry</span>: {
        <span class="hljs-attr">siteA</span>: [<span class="hljs-string">&#x27;./scss/siteA/main.scss&#x27;</span>],
        <span class="hljs-attr">siteB</span>: [<span class="hljs-string">&#x27;./scss/siteB/main.scss&#x27;</span>],
    },
    <span class="hljs-attr">output</span>: {
        <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;public/static&#x27;</span>, <span class="hljs-title function_">getCommitHash</span>()),     
    },
</code></pre>
<p>Expose the commit hash as an environment variable in the next.config.js:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> nextConfig = {
  <span class="hljs-attr">env</span>: {
    <span class="hljs-attr">PUBLIC_URL</span>: publicUrl,
    <span class="hljs-attr">COMMIT_HASH</span>: <span class="hljs-title function_">getCommitHash</span>(),
  },
</code></pre>
<p>And refer to this environment variable in the _app.tsx:</p>
<pre><code class="hljs language-javascript">
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params">{ Component, pageProps }: AppProps&lt;SitecorePageProps&gt;</span>): <span class="hljs-variable constant_">JSX</span>.<span class="hljs-property">Element</span> {
  <span class="hljs-keyword">const</span> { dictionary, ...rest } = pageProps;
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">Head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">static</span>/${<span class="hljs-attr">process.env.COMMIT_HASH</span>}/${(<span class="hljs-attr">pageProps.site.name</span>)}<span class="hljs-attr">.css</span>`} /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Head</span>&gt;</span>
</span></code></pre>
<p>That&#x27;s it! Now you have a unique stylesheet on each SXA site without any caching problems. Hope you find it useful.</p></div></article></main><section class="bg-gray-800 text-white py-12"><div class="container mx-auto px-4 text-center"><h2 class="text-2xl font-bold mb-6" id="connect">Connect With Me</h2><div class="flex justify-center space-x-6"><a href="https://github.com/erwinsmit" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span class="sr-only">GitHub</span></a><a href="https://www.linkedin.com/in/erwin-smit-40957840/" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg><span class="sr-only">LinkedIn</span></a></div></div></section><script src="/_next/static/chunks/webpack-8af1d2e0ff41d756.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"4:\"$Sreact.fragment\"\n5:I[7256,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"173\",\"static/chunks/173-e6c8bf506bfb93ff.js\",\"185\",\"static/chunks/app/layout-28f46ae9c6a8b2dc.js\"],\"default\"]\n6:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[4703,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"160\",\"static/chunks/app/not-found-081a5836cd82c2ca.js\"],\"default\"]\na:I[3120,[],\"OutletBoundary\"]\nc:I[3120,[],\"MetadataBoundary\"]\ne:I[3120,[],\"ViewportBoundary\"]\n10:I[6130,[],\"\"]\n1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/0f5f8cc0eb7d6afc.css\",\"style\"]\n3:HL[\"/_next/static/css/3a398bc4ce4edcc7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"qbAWKY8PVw4b-TN6TLmIA\",\"p\":\"\",\"c\":[\"\",\"blog\",\"xmcloud-nextjs-multisite-styling\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"xmcloud-nextjs-multisite-styling\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"xmcloud-nextjs-multisite-styling\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$4\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f5f8cc0eb7d6afc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/favicon/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/favicon/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon/safari-pinned-tab.svg\",\"color\":\"#000000\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon/favicon.ico\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-config\",\"content\":\"/favicon/browserconfig.xml\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-gray-100 [object Object]\",\"children\":[[\"$\",\"$L5\",null,{}],[\"$\",\"main\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L8\",null,{}],\"notFoundStyles\":[]}]}],[\"$\",\"section\",null,{\"className\":\"bg-gray-800 text-white py-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-4 text-center\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold mb-6\",\"id\":\"connect\",\"children\":\"Connect With Me\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-center space-x-6\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/erwinsmit\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-github\",\"children\":[[\"$\",\"path\",\"tonef\",{\"d\":\"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4\"}],[\"$\",\"path\",\"9comsn\",{\"d\":\"M9 18c-4.51 2-5-2-7-2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"GitHub\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/erwin-smit-40957840/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-linkedin\",\"children\":[[\"$\",\"path\",\"c2jq9f\",{\"d\":\"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z\"}],[\"$\",\"rect\",\"mk3on5\",{\"width\":\"4\",\"height\":\"12\",\"x\":\"2\",\"y\":\"9\"}],[\"$\",\"circle\",\"bt5ra8\",{\"cx\":\"4\",\"cy\":\"4\",\"r\":\"2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"LinkedIn\"}]]}]]}]]}]}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"xmcloud-nextjs-multisite-styling\",\"d\"],[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$4\",\"c\",{\"children\":[\"$L9\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3a398bc4ce4edcc7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}]]}],{},null]},null]},null]},null],[\"$\",\"$4\",\"h\",{\"children\":[null,[\"$\",\"$4\",\"aZjf_5JHhJvw9-4y0akFS\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"article\",null,{\"className\":\"max-w-7xl mx-auto px-8 my-12\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font\",\"children\":[\"$\",\"span\",null,{\"className\":\"bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500\",\"children\":\"Sitecore XM Cloud multisite styling\"}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center mb-16\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-base font-medium text-gray-600 group-hover:text-gray-800\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2024-01-17\",\"children\":\"January\\t17, 2024\"}]}]}],[\"$\",\"div\",null,{\"className\":\"prose lg:prose-xl max-w-none prose-pre:p-0\",\"children\":[[\"$\",\"p\",\"p-0\",{\"children\":\"I started working on an interesting Sitecore headless project, so it's time to start blogging about my findings again!\\nCurrently, I'm working on a project where a SXA multisite setup is migrated to XM Cloud.\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"Handling the multisite setup is now very easy thanks to the \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://doc.sitecore.com/xp/en/developers/hd/21/sitecore-headless-development/the-next-js-multisite-add-on.html\",\"children\":\"multisite Next.js addon\"}],\" provided by the JSS team.\"]}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"However, one thing I can't find in the documentation, how do you use a specific stylesheet for each SXA site?\\nWe are leaving the styling as-is, so I want to load the existing SCSS files into Next.js.\"}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":\"In Next.js you can add your SCSS to the application with a simple import:\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"'scss/styles.scss'\"}],\";\\n\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-title function_\",\"children\":\"App\"}],\"(\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-params\",\"children\":\"{ Component, pageProps }: AppProps\u003cSitecorePageProps\u003e\"}],\"): \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-variable constant_\",\"children\":\"JSX\"}],\".\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-property\",\"children\":\"Element\"}],\" {\\n  \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" { dictionary, ...rest } = pageProps;\\n  \\n  \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",\"span-9\",{\"className\":\"xml\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-tag\",\"children\":\"\u003c\u003e\"}],\"\\n      \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"I18nProvider\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"lngDict\"}],\"=\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"{dictionary}\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"locale\"}],\"=\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"{pageProps.locale}\"}],\"\u003e\"]}],\"\\n        \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"Component\"}],\" {\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"...rest\"}],\"} /\u003e\"]}],\"\\n      \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"I18nProvider\"}],\"\u003e\"]}],\"\\n    \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-tag\",\"children\":\"\u003c/\u003e\"}]]}],\"\\n  );\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"The problem I have here, you only know which site you are on \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"within\"}],\" the App function. And within the App function, it's not possible to import SCSS. With a couple of steps, I have worked around this.\"]}],\"\\n\",[\"$\",\"h2\",\"h2-0\",{\"children\":\"1. Build your SCSS yourself\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"Instead of using Next.js to build the SCSS, setup a webpack file yourself:\"}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-variable language_\",\"children\":\"module\"}],\".\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-property\",\"children\":\"exports\"}],\" = {\\n    \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-attr\",\"children\":\"entry\"}],\": {\\n        \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"siteA\"}],\": [\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"'./scss/siteA/main.scss'\"}],\"],\\n        \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-attr\",\"children\":\"siteB\"}],\": [\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"'./scss/siteB/main.scss'\"}],\"],\\n    },\\n    \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-attr\",\"children\":\"output\"}],\": {\\n        \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-attr\",\"children\":\"path\"}],\": path.\",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title function_\",\"children\":\"join\"}],\"(__dirname, \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-string\",\"children\":\"'public/static'\"}],\"),     \\n    },\\n    \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-attr\",\"children\":\"module\"}],\": {\\n        \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-attr\",\"children\":\"rules\"}],\": [\\n            {\\n                \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-comment\",\"children\":\"// Using MiniCssExtractPlugin to write the output to its own file.\"}],\"\\n                \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-attr\",\"children\":\"test\"}],\": \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-regexp\",\"children\":\"/\\\\.scss$/\"}],\",\\n                \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-attr\",\"children\":\"use\"}],\": [\\n                    {\\n                        \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-attr\",\"children\":\"loader\"}],\": \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-title class_\",\"children\":\"MiniCssExtractPlugin\"}],\".\",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-property\",\"children\":\"loader\"}],\",\\n                    },\\n                    {\\n                        \",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-attr\",\"children\":\"loader\"}],\": \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-string\",\"children\":\"'css-loader'\"}],\",\\n                        \",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-attr\",\"children\":\"options\"}],\": {\\n                            \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-attr\",\"children\":\"importLoaders\"}],\": \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-number\",\"children\":\"2\"}],\"\\n                        }\\n                    },\\n                    {\\n                        \",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-attr\",\"children\":\"loader\"}],\": \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-string\",\"children\":\"'postcss-loader'\"}],\",\\n                    },\\n                    {\\n                        \",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-attr\",\"children\":\"loader\"}],\": \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-string\",\"children\":\"'sass-loader'\"}],\",\\n                        \",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-attr\",\"children\":\"options\"}],\": {\\n                            \",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-attr\",\"children\":\"implementation\"}],\": \",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-built_in\",\"children\":\"require\"}],\"(\",[\"$\",\"span\",\"span-32\",{\"className\":\"hljs-string\",\"children\":\"\\\"sass\\\"\"}],\"),\\n                        }\\n                    }\\n                ]\\n            },\\n            \\n        ]\\n    },\\n    \",[\"$\",\"span\",\"span-33\",{\"className\":\"hljs-attr\",\"children\":\"plugins\"}],\": [\\n        \",[\"$\",\"span\",\"span-34\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-35\",{\"className\":\"hljs-title class_\",\"children\":\"MiniCssExtractPlugin\"}],\"({\\n            \",[\"$\",\"span\",\"span-36\",{\"className\":\"hljs-attr\",\"children\":\"filename\"}],\": \",[\"$\",\"span\",\"span-37\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"{ chunk }\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",\"span-38\",{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":[\"$${chunk.name.replace(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-string\",\"children\":\"'/js/'\"}],\", \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"'/css/'\"}],\")}\"]}],\".css`\"]}],\",\\n        })\\n    ]\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":\"Now add the following tasks to your package.json:\"}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-json\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"\\\"build:scss\\\"\"}],[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"rimraf public/static \u0026\u0026 webpack --config webpack.scss.config.js --mode production\\\"\"}],[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"\\\"scss:watch\\\"\"}],[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"\\\"rimraf public/static \u0026\u0026 webpack --config webpack.scss.config.js --mode development --watch\\\"\"}],[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"Add the watch and build tasks to the existing start and build scripts so they are run during development and build:\"}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-json\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"\\\"build\\\"\"}],[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"npm-run-all --serial bootstrap next:build build:scss\\\"\"}],[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"\\\"start:connected\\\"\"}],[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"\\\"npm-run-all --serial bootstrap --parallel next:dev start:watch-components scss:watch\\\"\"}],[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"    \\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":[\"As you notice I am using the \",[\"$\",\"code\",\"code-0\",{\"children\":\"public/static\"}],\" directory for build assets, so it's a good idea to add \",[\"$\",\"code\",\"code-1\",{\"children\":\"public/static\"}],\" to your .gitignore file and remove the directory on each build (using \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.npmjs.com/package/rimraf\",\"children\":\"rimraf\"}],\" in the example).\"]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":[\"In the \",[\"$\",\"code\",\"code-0\",{\"children\":\"_app.tsx\"}],\" you can now refer to the correct stylesheet based on the SXA site:\"]}],\"\\n\",[\"$\",\"pre\",\"pre-4\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-comment\",\"children\":\"/* eslint-disable @next/next/no-css-tags */\"}],\"\\n\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-title function_\",\"children\":\"App\"}],\"(\",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-params\",\"children\":\"{ Component, pageProps }: AppProps\u003cSitecorePageProps\u003e\"}],\"): \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-variable constant_\",\"children\":\"JSX\"}],\".\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-property\",\"children\":\"Element\"}],\" {\\n  \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" { dictionary, ...rest } = pageProps;\\n  \\n  \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",\"span-8\",{\"className\":\"xml\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-tag\",\"children\":\"\u003c\u003e\"}],\"\\n    \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"Head\"}],\"\u003e\"]}],\"\\n      \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"link\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"rel\"}],\"=\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"stylesheet\\\"\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"href\"}],\"=\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"{\"}],\"`/\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-attr\",\"children\":\"static\"}],\"/${(\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-attr\",\"children\":\"pageProps.site.name\"}],\")}\",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-attr\",\"children\":\".css\"}],\"`} /\u003e\"]}],\"\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"Head\"}],\"\u003e\"]}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":[\"I added the \",[\"$\",\"code\",\"code-0\",{\"children\":\"/* eslint-disable @next/next/no-css-tags */\"}],\" line because \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://nextjs.org/docs/messages/no-css-tags\",\"children\":\"Next.js doesn't like it\"}],\" when you add CSS with a regular stylesheet link. I think this is silly, we have been adding stylesheets this way for 20 years. So I have no problem using this eslint-disable line. I'm also not seeing any performance concerns here.\"]}],\"\\n\",[\"$\",\"h2\",\"h2-1\",{\"children\":\"2. What about caching?\"}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":[\"By default the public directory from Next.js does not cache, see my \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.erwinsmit.com/caching-nextjs-public-directory/\",\"children\":\"previous blog post\"}],\" on how to resolve that. How do you make sure users don't see a stale version when new CSS is deployed?\"]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":[\"First, I tried to use the \",[\"$\",\"code\",\"code-0\",{\"children\":\"BUILD_ID\"}],\" (located in the .next directory) from Next as a prefix to the CSS path. However, that can't be accessed on build-time because the \",[\"$\",\"code\",\"code-1\",{\"children\":\"BUILD_ID\"}],\" is not generated until the build is actually complete.\"]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":[\"So instead, I decided to use the current \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"commit hash\"}],\", meaning that with each build there will automatically be a fresh CSS file with a long cache-header.\"]}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":\"First, create a script that returns a short version of the commit hash:\"}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":[\"$\",\"strong\",\"strong-0\",{\"children\":\"getCommitHash.js\"}]}],\"\\n\",[\"$\",\"pre\",\"pre-5\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" getCommitHash = \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\"(\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n        \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-built_in\",\"children\":\"require\"}],\"(\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"'child_process'\"}],\")\\n        .\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-title function_\",\"children\":\"execSync\"}],\"(\",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-string\",\"children\":\"'git log --pretty=format:\\\"%h\\\" -n1'\"}],\")\\n        .\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-title function_\",\"children\":\"toString\"}],\"()\\n        .\",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title function_\",\"children\":\"trim\"}],\"()\\n    );\\n}\\n\\n\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-variable language_\",\"children\":\"module\"}],\".\",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-property\",\"children\":\"exports\"}],\" = getCommitHash;\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"In the webpack config responsible for building the CSS, place the CSS files in a path containing the commit hash:\"}],\"\\n\",[\"$\",\"pre\",\"pre-6\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-variable language_\",\"children\":\"module\"}],\".\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-property\",\"children\":\"exports\"}],\" = {\\n    \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-attr\",\"children\":\"entry\"}],\": {\\n        \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"siteA\"}],\": [\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"'./scss/siteA/main.scss'\"}],\"],\\n        \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-attr\",\"children\":\"siteB\"}],\": [\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"'./scss/siteB/main.scss'\"}],\"],\\n    },\\n    \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-attr\",\"children\":\"output\"}],\": {\\n        \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-attr\",\"children\":\"path\"}],\": path.\",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title function_\",\"children\":\"join\"}],\"(__dirname, \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-string\",\"children\":\"'public/static'\"}],\", \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-title function_\",\"children\":\"getCommitHash\"}],\"()),     \\n    },\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":\"Expose the commit hash as an environment variable in the next.config.js:\"}],\"\\n\",[\"$\",\"pre\",\"pre-7\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" nextConfig = {\\n  \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"env\"}],\": {\\n    \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-attr\",\"children\":\"PUBLIC_URL\"}],\": publicUrl,\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"COMMIT_HASH\"}],\": \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-title function_\",\"children\":\"getCommitHash\"}],\"(),\\n  },\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":\"And refer to this environment variable in the _app.tsx:\"}],\"\\n\",[\"$\",\"pre\",\"pre-8\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[\"\\n\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title function_\",\"children\":\"App\"}],\"(\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-params\",\"children\":\"{ Component, pageProps }: AppProps\u003cSitecorePageProps\u003e\"}],\"): \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-variable constant_\",\"children\":\"JSX\"}],\".\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-property\",\"children\":\"Element\"}],\" {\\n  \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" { dictionary, ...rest } = pageProps;\\n  \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" (\\n    \",[\"$\",\"span\",\"span-7\",{\"className\":\"xml\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-tag\",\"children\":\"\u003c\u003e\"}],\"\\n    \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"Head\"}],\"\u003e\"]}],\"\\n      \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"link\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"rel\"}],\"=\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"stylesheet\\\"\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"href\"}],\"=\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"{\"}],\"`/\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-attr\",\"children\":\"static\"}],\"/${\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-attr\",\"children\":\"process.env.COMMIT_HASH\"}],\"}/${(\",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-attr\",\"children\":\"pageProps.site.name\"}],\")}\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-attr\",\"children\":\".css\"}],\"`} /\u003e\"]}],\"\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-tag\",\"children\":[\"\u003c/\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-name\",\"children\":\"Head\"}],\"\u003e\"]}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":\"That's it! Now you have a unique stylesheet on each SXA site without any caching problems. Hope you find it useful.\"}]]}]]}]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Sitecore XM Cloud multisite styling\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"Sitecore XM Cloud multisite styling\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:title\",\"content\":\"Sitecore XM Cloud multisite styling\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>