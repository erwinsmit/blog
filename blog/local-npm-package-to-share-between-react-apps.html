<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/87cbc7cac530fcf5.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3a398bc4ce4edcc7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8af1d2e0ff41d756.js"/><script src="/_next/static/chunks/4bd1b696-05ac3765304a89c0.js" async=""></script><script src="/_next/static/chunks/215-c1a7d2d931604563.js" async=""></script><script src="/_next/static/chunks/main-app-e5edefe120089e16.js" async=""></script><script src="/_next/static/chunks/231-015614b9a59ae6eb.js" async=""></script><script src="/_next/static/chunks/173-e6c8bf506bfb93ff.js" async=""></script><script src="/_next/static/chunks/app/layout-28f46ae9c6a8b2dc.js" async=""></script><script src="/_next/static/chunks/app/not-found-081a5836cd82c2ca.js" async=""></script><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><title>Creating local npm package for sharing between multiple react applications</title><meta name="description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta property="og:title" content="Creating local npm package for sharing between multiple react applications"/><meta property="og:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Creating local npm package for sharing between multiple react applications"/><meta name="twitter:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="bg-gray-100 [object Object]"><header class="bg-blue-600 text-white shadow-md"><div class="container mx-auto px-4 py-4"><div class="flex justify-between items-center"><a href="/"><div class="flex items-center space-x-4 bg-blue-700 rounded-full py-2 px-4"><img alt="Erwin Smit" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" class="rounded-full border-2 border-white" style="color:transparent;height:40px;width:40px;object-fit:cover" src="/assets/selfie2.jpg"/><span class="font-semibold text-lg text-white">Erwin Smit</span></div></a><nav class="flex-grow"><ul class="flex justify-end space-x-6"><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/">About me</a></li><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/blog">Blog</a></li></ul></nav></div></div></header><main class="min-h-screen"><article class="max-w-7xl mx-auto px-8 my-12"><h1 class="w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font"><span class="bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500">Creating local npm package for sharing between multiple react applications</span></h1><div class="flex items-center justify-center mb-16"><p class="text-base font-medium text-gray-600 group-hover:text-gray-800"><time dateTime="2019-09-16">September	16, 2019</time></p></div><div class="prose lg:prose-xl max-w-none prose-pre:p-0"><h2>The usecase</h2>
<p>At the project I&#x27;m working on currently we have multiple react apps running alongside of each other. These apps are using &quot;Create react app&quot;, we like using CRA because of all the best practices it enforces on the user and the fact that it&#x27;s well maintained by people that know their way around a webpack configuration.</p>
<p>One of the best practices it enforces is that you are not allowed to include files from outside of the src directory.
So if you want to share code between multiple react applications the only (non-hacky) way is to create npm packages that contain transpiled code. The code has to be transpiled because CRA will only do the compile step on npm packages.</p>
<h3>Tools</h3>
<p>To achieve this we use LernaJS to link all the dependencies to the correct react applications. Maybe I will write another blog post about this later but for now I will simply list the directory structure:</p>
<ul>
<li>CRA application 1</li>
<li>CRA application 2</li>
<li>ClientCore (our local npm package)</li>
</ul>
<p>In the react applications we can include the &quot;ClientCore&quot; dependency in the package.json. When we run <code>lerna bootstrap</code> it will create symlinks in the &quot;node_modules&quot; directory to our local package.</p>
<p>The tool we use to transpile our &quot;ClientCore&quot; package is Rollup. Let&#x27;s get started with that!</p>
<h3>Rollup config</h3>
<p>I prefer to set all the rollup configuration in a separate file and link to it in your package.json.</p>
<pre><code class="hljs language-json"><span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">&quot;transpile&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;rollup --config ./rollup.config.js&quot;</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>The basic rollup configuration can look like this</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-attr">input</span>: <span class="hljs-string">&#x27;index.ts&#x27;</span>,
    <span class="hljs-attr">output</span>: [
        {
            <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/index.js&#x27;</span> ,
            <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;cjs&#x27;</span>,
        },
        {
            <span class="hljs-attr">file</span>: <span class="hljs-string">&#x27;dist/index.es.js&#x27;</span>
            <span class="hljs-attr">format</span>: <span class="hljs-string">&#x27;esm&#x27;</span>
        }
    ]
}
</code></pre>
<p>This is all you need to transpile your bundle to CommonJS and ES modules. I find this enough because I don&#x27;t need to support applications that want a UMD/IFFE build which can load straight into the browser. If you are writing a NPM module for the whole world to use you can consider adding these formats as well.</p>
<p>Next add the pointer to the dist map to the package.json file:</p>
<pre><code class="hljs language-json">  <span class="hljs-attr">&quot;main&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/index.js&quot;</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">&quot;module&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;dist/index.es.js&quot;</span><span class="hljs-punctuation">,</span>
</code></pre>
<p>Main refers to the CJS build and module to the ES build.</p>
<h3>Typescript support</h3>
<p>Because we use typescript we also need a plugin to transpile this correctly and give us errors when make a mistake. To add typescript support you can add this to the top of the configuration file (and install the dependency).</p>
<p><code>import typescript from &#x27;rollup-plugin-typescript2&#x27;</code></p>
<p>Next you add a new entry to the rollup config to specify the plugins.</p>
<pre><code class="hljs language-javascript"><span class="hljs-attr">plugins</span>: [ <span class="hljs-title function_">typescript</span>() ] 
</code></pre>
<p>To also automatically generate type definitions (d.ts files) add these two lines to your tsconfig.json:</p>
<pre><code class="hljs language-json"><span class="hljs-attr">&quot;declaration&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
<span class="hljs-attr">&quot;declarationDir&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;./dist&quot;</span> 
</code></pre>
<h3>Gotcha&#x27;s - lazy loading &amp; commonJS</h3>
<p>When using a client side application the only reason to use the CJS build is for dynamic imports (lazy loading) as far as I&#x27;m aware. The big difference between the CJS and ES build is that everything will always be imported.</p>
<p>For example, when your module exports 2 functions:</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;testing 12&#x27;</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-title function_">default</span> () =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;default&#x27;</span>
}
</code></pre>
<p>And in your react application you import test</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">const</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ClientCore&#x27;</span>).<span class="hljs-property">test</span>

</code></pre>
<p>You also get the all the other stuff from that javascript file. But when you import <code>test</code> using ES modules you only get the code you actually need.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> { test } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ClientCore&#x27;</span>
</code></pre>
<p>So always keep this in mind when you want to lazy-load javascript or when you are changing modules that could be lazy loaded somewhere! A misplaced import could suddenly make your lazy loading strategy worthless.</p>
<h3>Gotcha&#x27;s - circular dependencies</h3>
<p>What&#x27;s a circular dependency? The most simple case of a circular dependecy looks like this:</p>
<pre><code class="hljs language-typescript">- <span class="hljs-title class_">Dep1</span>.<span class="hljs-property">ts</span>

<span class="hljs-keyword">import</span> { dep2Function } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dep2.ts&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dep1Function</span>(<span class="hljs-params"></span>) {

}


- <span class="hljs-title class_">Dep2</span>.<span class="hljs-property">ts</span>

<span class="hljs-keyword">import</span> { dep1Function  } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dep2.ts&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dep2Function</span>(<span class="hljs-params"></span>) {

}
</code></pre>
<p>This is the most simple case of circular dependency. You should of course avoid to write code like this but there are also much more complicated cases of circular dependencies. Rollup will give you warnings about this and rightly so. Circular dependencies can create very hard to track down bugs when the dependencies hold some state or when they extend classes.</p>
<p>To tackle these bugs I found this great <a href="https://medium.com/visual-development/how-to-fix-nasty-circular-dependency-issues-once-and-for-all-in-javascript-typescript-a04c987cf0de">blogpost</a> that explains how to use the <code>internal module pattern</code> to resolve this.</p>
<p>Basically all you have to do is to handle all the exports / imports using an internal.ts file.</p>
<p>So to fix our case from above the code should be:</p>
<pre><code class="hljs language-typescript">- <span class="hljs-title class_">Dep1</span>.<span class="hljs-property">ts</span>

<span class="hljs-keyword">import</span> { dep2Function } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./internal.ts&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dep1Function</span>(<span class="hljs-params"></span>) {

}

- <span class="hljs-title class_">Dep2</span>.<span class="hljs-property">ts</span>

<span class="hljs-keyword">import</span> { dep1Function  } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./internal.ts&#x27;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dep2Function</span>(<span class="hljs-params"></span>) {

}

- internal.<span class="hljs-property">ts</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dep1.ts&#x27;</span>
<span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./dep2.ts&#x27;</span>
</code></pre></div></article></main><section class="bg-gray-800 text-white py-12"><div class="container mx-auto px-4 text-center"><h2 class="text-2xl font-bold mb-6" id="connect">Connect With Me</h2><div class="flex justify-center space-x-6"><a href="https://github.com/erwinsmit" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span class="sr-only">GitHub</span></a><a href="https://www.linkedin.com/in/erwin-smit-40957840/" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg><span class="sr-only">LinkedIn</span></a></div></div></section><script src="/_next/static/chunks/webpack-8af1d2e0ff41d756.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"4:\"$Sreact.fragment\"\n5:I[7256,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"173\",\"static/chunks/173-e6c8bf506bfb93ff.js\",\"185\",\"static/chunks/app/layout-28f46ae9c6a8b2dc.js\"],\"default\"]\n6:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[4703,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"160\",\"static/chunks/app/not-found-081a5836cd82c2ca.js\"],\"default\"]\na:I[3120,[],\"OutletBoundary\"]\nc:I[3120,[],\"MetadataBoundary\"]\ne:I[3120,[],\"ViewportBoundary\"]\n10:I[6130,[],\"\"]\n1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/87cbc7cac530fcf5.css\",\"style\"]\n3:HL[\"/_next/static/css/3a398bc4ce4edcc7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"ptcqMak2BrWXcsN6GKwMc\",\"p\":\"\",\"c\":[\"\",\"blog\",\"local-npm-package-to-share-between-react-apps\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"local-npm-package-to-share-between-react-apps\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"local-npm-package-to-share-between-react-apps\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$4\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/87cbc7cac530fcf5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/favicon/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/favicon/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon/safari-pinned-tab.svg\",\"color\":\"#000000\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon/favicon.ico\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-config\",\"content\":\"/favicon/browserconfig.xml\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-gray-100 [object Object]\",\"children\":[[\"$\",\"$L5\",null,{}],[\"$\",\"main\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L8\",null,{}],\"notFoundStyles\":[]}]}],[\"$\",\"section\",null,{\"className\":\"bg-gray-800 text-white py-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-4 text-center\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold mb-6\",\"id\":\"connect\",\"children\":\"Connect With Me\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-center space-x-6\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/erwinsmit\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-github\",\"children\":[[\"$\",\"path\",\"tonef\",{\"d\":\"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4\"}],[\"$\",\"path\",\"9comsn\",{\"d\":\"M9 18c-4.51 2-5-2-7-2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"GitHub\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/erwin-smit-40957840/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-linkedin\",\"children\":[[\"$\",\"path\",\"c2jq9f\",{\"d\":\"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z\"}],[\"$\",\"rect\",\"mk3on5\",{\"width\":\"4\",\"height\":\"12\",\"x\":\"2\",\"y\":\"9\"}],[\"$\",\"circle\",\"bt5ra8\",{\"cx\":\"4\",\"cy\":\"4\",\"r\":\"2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"LinkedIn\"}]]}]]}]]}]}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"local-npm-package-to-share-between-react-apps\",\"d\"],[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$4\",\"c\",{\"children\":[\"$L9\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3a398bc4ce4edcc7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}]]}],{},null]},null]},null]},null],[\"$\",\"$4\",\"h\",{\"children\":[null,[\"$\",\"$4\",\"KoXpNyOGfQ8aRcjPU5Siz\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"article\",null,{\"className\":\"max-w-7xl mx-auto px-8 my-12\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font\",\"children\":[\"$\",\"span\",null,{\"className\":\"bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500\",\"children\":\"Creating local npm package for sharing between multiple react applications\"}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center mb-16\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-base font-medium text-gray-600 group-hover:text-gray-800\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2019-09-16\",\"children\":\"September\\t16, 2019\"}]}]}],[\"$\",\"div\",null,{\"className\":\"prose lg:prose-xl max-w-none prose-pre:p-0\",\"children\":[[\"$\",\"h2\",\"h2-0\",{\"children\":\"The usecase\"}],\"\\n\",[\"$\",\"p\",\"p-0\",{\"children\":\"At the project I'm working on currently we have multiple react apps running alongside of each other. These apps are using \\\"Create react app\\\", we like using CRA because of all the best practices it enforces on the user and the fact that it's well maintained by people that know their way around a webpack configuration.\"}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":\"One of the best practices it enforces is that you are not allowed to include files from outside of the src directory.\\nSo if you want to share code between multiple react applications the only (non-hacky) way is to create npm packages that contain transpiled code. The code has to be transpiled because CRA will only do the compile step on npm packages.\"}],\"\\n\",[\"$\",\"h3\",\"h3-0\",{\"children\":\"Tools\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":\"To achieve this we use LernaJS to link all the dependencies to the correct react applications. Maybe I will write another blog post about this later but for now I will simply list the directory structure:\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"CRA application 1\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"CRA application 2\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"ClientCore (our local npm package)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":[\"In the react applications we can include the \\\"ClientCore\\\" dependency in the package.json. When we run \",[\"$\",\"code\",\"code-0\",{\"children\":\"lerna bootstrap\"}],\" it will create symlinks in the \\\"node_modules\\\" directory to our local package.\"]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":\"The tool we use to transpile our \\\"ClientCore\\\" package is Rollup. Let's get started with that!\"}],\"\\n\",[\"$\",\"h3\",\"h3-1\",{\"children\":\"Rollup config\"}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":\"I prefer to set all the rollup configuration in a separate file and link to it in your package.json.\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-json\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"\\\"scripts\\\"\"}],[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-punctuation\",\"children\":\"{\"}],\"\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"\\\"transpile\\\"\"}],[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"\\\"rollup --config ./rollup.config.js\\\"\"}],\"\\n\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-punctuation\",\"children\":\"}\"}],[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":\"The basic rollup configuration can look like this\"}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" {\\n    \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-attr\",\"children\":\"input\"}],\": \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"'index.ts'\"}],\",\\n    \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"output\"}],\": [\\n        {\\n            \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-attr\",\"children\":\"file\"}],\": \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"'dist/index.js'\"}],\" ,\\n            \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-attr\",\"children\":\"format\"}],\": \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-string\",\"children\":\"'cjs'\"}],\",\\n        },\\n        {\\n            \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-attr\",\"children\":\"file\"}],\": \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-string\",\"children\":\"'dist/index.es.js'\"}],\"\\n            \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-attr\",\"children\":\"format\"}],\": \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-string\",\"children\":\"'esm'\"}],\"\\n        }\\n    ]\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"This is all you need to transpile your bundle to CommonJS and ES modules. I find this enough because I don't need to support applications that want a UMD/IFFE build which can load straight into the browser. If you are writing a NPM module for the whole world to use you can consider adding these formats as well.\"}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":\"Next add the pointer to the dist map to the package.json file:\"}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-json\",\"children\":[\"  \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"\\\"main\\\"\"}],[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"dist/index.js\\\"\"}],[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n  \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"\\\"module\\\"\"}],[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"\\\"dist/index.es.js\\\"\"}],[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":\"Main refers to the CJS build and module to the ES build.\"}],\"\\n\",[\"$\",\"h3\",\"h3-2\",{\"children\":\"Typescript support\"}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":\"Because we use typescript we also need a plugin to transpile this correctly and give us errors when make a mistake. To add typescript support you can add this to the top of the configuration file (and install the dependency).\"}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":[\"$\",\"code\",\"code-0\",{\"children\":\"import typescript from 'rollup-plugin-typescript2'\"}]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":\"Next you add a new entry to the rollup config to specify the plugins.\"}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"plugins\"}],\": [ \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title function_\",\"children\":\"typescript\"}],\"() ] \\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":\"To also automatically generate type definitions (d.ts files) add these two lines to your tsconfig.json:\"}],\"\\n\",[\"$\",\"pre\",\"pre-4\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-json\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"\\\"declaration\\\"\"}],[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-literal\",\"children\":[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"true\"}]}],[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-punctuation\",\"children\":\",\"}],\"\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"\\\"declarationDir\\\"\"}],[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-string\",\"children\":\"\\\"./dist\\\"\"}],\" \\n\"]}]}],\"\\n\",[\"$\",\"h3\",\"h3-3\",{\"children\":\"Gotcha's - lazy loading \u0026 commonJS\"}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":\"When using a client side application the only reason to use the CJS build is for dynamic imports (lazy loading) as far as I'm aware. The big difference between the CJS and ES build is that everything will always be imported.\"}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":\"For example, when your module exports 2 functions:\"}],\"\\n\",[\"$\",\"pre\",\"pre-5\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-title function_\",\"children\":\"test\"}],\"(\",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-params\"}],\") {\\n    \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"'testing 12'\"}],\"\\n}\\n\\n\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-title function_\",\"children\":\"default\"}],\" () =\u003e {\\n    \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-string\",\"children\":\"'default'\"}],\"\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"And in your react application you import test\"}],\"\\n\",[\"$\",\"pre\",\"pre-6\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" test = \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-built_in\",\"children\":\"require\"}],\"(\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"'ClientCore'\"}],\").\",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-property\",\"children\":\"test\"}],\"\\n\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":[\"You also get the all the other stuff from that javascript file. But when you import \",[\"$\",\"code\",\"code-0\",{\"children\":\"test\"}],\" using ES modules you only get the code you actually need.\"]}],\"\\n\",[\"$\",\"pre\",\"pre-7\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { test } \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"'ClientCore'\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":\"So always keep this in mind when you want to lazy-load javascript or when you are changing modules that could be lazy loaded somewhere! A misplaced import could suddenly make your lazy loading strategy worthless.\"}],\"\\n\",[\"$\",\"h3\",\"h3-4\",{\"children\":\"Gotcha's - circular dependencies\"}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":\"What's a circular dependency? The most simple case of a circular dependecy looks like this:\"}],\"\\n\",[\"$\",\"pre\",\"pre-8\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[\"- \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-title class_\",\"children\":\"Dep1\"}],\".\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-property\",\"children\":\"ts\"}],\"\\n\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { dep2Function } \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"'./dep2.ts'\"}],\"\\n\\n\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-title function_\",\"children\":\"dep1Function\"}],\"(\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-params\"}],\") {\\n\\n}\\n\\n\\n- \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title class_\",\"children\":\"Dep2\"}],\".\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-property\",\"children\":\"ts\"}],\"\\n\\n\",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { dep1Function  } \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-string\",\"children\":\"'./dep2.ts'\"}],\"\\n\\n\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"dep2Function\"}],\"(\",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-params\"}],\") {\\n\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"children\":\"This is the most simple case of circular dependency. You should of course avoid to write code like this but there are also much more complicated cases of circular dependencies. Rollup will give you warnings about this and rightly so. Circular dependencies can create very hard to track down bugs when the dependencies hold some state or when they extend classes.\"}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"children\":[\"To tackle these bugs I found this great \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://medium.com/visual-development/how-to-fix-nasty-circular-dependency-issues-once-and-for-all-in-javascript-typescript-a04c987cf0de\",\"children\":\"blogpost\"}],\" that explains how to use the \",[\"$\",\"code\",\"code-0\",{\"children\":\"internal module pattern\"}],\" to resolve this.\"]}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"children\":\"Basically all you have to do is to handle all the exports / imports using an internal.ts file.\"}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"children\":\"So to fix our case from above the code should be:\"}],\"\\n\",[\"$\",\"pre\",\"pre-9\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[\"- \",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-title class_\",\"children\":\"Dep1\"}],\".\",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-property\",\"children\":\"ts\"}],\"\\n\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { dep2Function } \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"'./internal.ts'\"}],\"\\n\\n\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-title function_\",\"children\":\"dep1Function\"}],\"(\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-params\"}],\") {\\n\\n}\\n\\n- \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title class_\",\"children\":\"Dep2\"}],\".\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-property\",\"children\":\"ts\"}],\"\\n\\n\",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" { dep1Function  } \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-string\",\"children\":\"'./internal.ts'\"}],\"\\n\\n\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"dep2Function\"}],\"(\",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-params\"}],\") {\\n\\n}\\n\\n- internal.\",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-property\",\"children\":\"ts\"}],\"\\n\",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" * \",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-string\",\"children\":\"'./dep1.ts'\"}],\"\\n\",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" * \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-string\",\"children\":\"'./dep2.ts'\"}],\"\\n\"]}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Creating local npm package for sharing between multiple react applications\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"Creating local npm package for sharing between multiple react applications\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:title\",\"content\":\"Creating local npm package for sharing between multiple react applications\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>