<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/blog/hydration.jpg"/><link rel="preload" as="image" href="/blog/lighthouse-not-happy.jpg"/><link rel="preload" as="image" href="/blog/lighthouse-no-render-blockers.jpg"/><link rel="preload" as="image" href="/blog/lighthouse-unused-javascript.jpg"/><link rel="preload" as="image" href="/blog/codesplitting-requests.jpg"/><link rel="preload" as="image" href="/blog/duplicate-code.jpg"/><link rel="stylesheet" href="/_next/static/css/0f5f8cc0eb7d6afc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/3a398bc4ce4edcc7.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-8af1d2e0ff41d756.js"/><script src="/_next/static/chunks/4bd1b696-05ac3765304a89c0.js" async=""></script><script src="/_next/static/chunks/215-c1a7d2d931604563.js" async=""></script><script src="/_next/static/chunks/main-app-e5edefe120089e16.js" async=""></script><script src="/_next/static/chunks/231-015614b9a59ae6eb.js" async=""></script><script src="/_next/static/chunks/173-e6c8bf506bfb93ff.js" async=""></script><script src="/_next/static/chunks/app/layout-28f46ae9c6a8b2dc.js" async=""></script><script src="/_next/static/chunks/app/not-found-081a5836cd82c2ca.js" async=""></script><meta name="next-size-adjust"/><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"/><link rel="manifest" href="/favicon/site.webmanifest"/><link rel="mask-icon" href="/favicon/safari-pinned-tab.svg" color="#000000"/><link rel="shortcut icon" href="/favicon/favicon.ico"/><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-config" content="/favicon/browserconfig.xml"/><meta name="theme-color" content="#000"/><link rel="alternate" type="application/rss+xml" href="/feed.xml"/><title>Speed up your Sitecore React implementation</title><meta name="description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta property="og:title" content="Speed up your Sitecore React implementation"/><meta property="og:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Speed up your Sitecore React implementation"/><meta name="twitter:description" content="Erwin Smit - Freelance frontend developer / fullstack developer"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="bg-gray-100 [object Object]"><header class="bg-blue-600 text-white shadow-md"><div class="container mx-auto px-4 py-4"><div class="flex justify-between items-center"><a href="/"><div class="flex items-center space-x-4 bg-blue-700 rounded-full py-2 px-4"><img alt="Erwin Smit" loading="lazy" width="40" height="40" decoding="async" data-nimg="1" class="rounded-full border-2 border-white" style="color:transparent;height:40px;width:40px;object-fit:cover" src="/assets/selfie2.jpg"/><span class="font-semibold text-lg text-white">Erwin Smit</span></div></a><nav class="flex-grow"><ul class="flex justify-end space-x-6"><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/">About me</a></li><li><a class="hover:text-blue-200 transition duration-150 ease-in-out" href="/blog">Blog</a></li></ul></nav></div></div></header><main class="min-h-screen"><article class="max-w-7xl mx-auto px-8 my-12"><h1 class="w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font"><span class="bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500">Speed up your Sitecore React implementation</span></h1><div class="flex items-center justify-center mb-16"><p class="text-base font-medium text-gray-600 group-hover:text-gray-800"><time dateTime="2021-02-11">February	11, 2021</time></p></div><div class="prose lg:prose-xl max-w-none prose-pre:p-0"><p>On a lot of Sitecore sites that jumped on the React bandwagon a while ago I notice some performance issues. In this post I will explain how to fix this and make your Sitecore/React implementation almost as fast as a site built with <a href="https://www.erwinsmit.com/make-your-sxa-site-perform/">Stencil components</a></p>
<p>The two main issues with these websites are <strong>Render blocking script tags</strong> and <strong>unused javascript</strong>. Let&#x27;s fix it!</p>
<h2>Render blocking script tags</h2>
<p>I created a static <a href="https://www.erwinsmit.com/performancepoc/index.html">html page</a> that reflects how many Sitecore sites work, it has inline script tags that refer to React components. Although these components are already rendered server side they still need to be &quot;Hydrated&quot;. Hydration of a React component adds all the client side magic like event listeners, state changes, hooks etc.</p>
<p><img src="/blog/hydration.jpg" alt="" title="Hydrate React component"/></p>
<p>It&#x27;s no exception to have about 20 of these inline script tags on the page to hydrate all the necessary React components. There are two issues with this approach. Every script tag that is not at the absolute bottom of the page <strong>blocks the rendering</strong> of the HTML that follows, so the footer will not be rendered <strong>until</strong> the script tags in the main section are executed. The same applies for the rendering of the main section, this will not happen until the hydration of the header navigation is completed. For performance reasons this is not ideal, the HTML of the components is already server side rendered meaning that the user can see and interact with most of the HTML.</p>
<p>The <strong>second issue</strong> with this approach is the dependency on global modules within the script tags, &quot;ClientX.default.Navigation&quot; needs to be registered on the Window object otherwise runtime exceptions will occur. Therefore the JavaScript bundle responsible for registering these components is at the top of the page. As a result the browser first needs to load and execute this script before it can render the HTML. You can imagine tools like Google Lighthouse are not happy with this!</p>
<p><img src="/blog/lighthouse-not-happy.jpg" alt="" title="Lighthouse isn&#x27;t happy!"/></p>
<h3>How to fix this?</h3>
<p>In the entrypoint for the client bundle the code usually looks like this:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=React!react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=ReactDOM!react-dom&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=ClientX!../src/components&quot;</span>;
</code></pre>
<p>React &amp; ReactDOM are exposed to the window object and src/components refers to a entrypoint for all the components used within the sitecore rendering. That entrypoint is usually built up with a lot of imports and exports:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchResults</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./30_Organisms/Blog/BlogPostsOverview&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SearchBox</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./30_Organisms/SearchBox/container&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BlogPostDetails</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./30_Organisms/Blog/BlogPostDetails&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Contact</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./20_Molecules/Contact&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NavigationSearchBox</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./30_Organisms/SearchBox/variants/SimpleSearchBox&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BannerTeaser</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./20_Molecules/Teasers/BannerTeaser&quot;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title class_">BlockTeaser</span>,
  <span class="hljs-title class_">Button</span>,
  <span class="hljs-variable constant_">FAQ</span>,
  <span class="hljs-title class_">FAQList</span>,
  <span class="hljs-title class_">NavigationImageList</span>,
  <span class="hljs-title class_">FooterMainImage</span>,
};
</code></pre>
<p>This causes the components to be registered on the window object like &quot;window.ClientX.default.FAQ&quot;</p>
<p>To fix the render blocking we first put HTML comments <!-- --> around all the hydration script. I also added a react-data-hydrate attribute so they are easily distinguishable from other inline scripts (e.g. Google tag manager).</p>
<pre><code class="hljs language-html"><span class="hljs-comment">&lt;!--&lt;script data-react-hydrate&gt;
        ReactDOM.hydrate(React.createElement(ClientX.default.Navigation, 
        { &quot;module&quot;: &quot;ClientX.default.Navigation&quot;, &quot;id&quot;: &quot;a2feda75-fd69-4811-962a-dd5411e3e7dd&quot;, &quot;name&quot;: &quot;Main Navigation&quot;, &quot;variant&quot;: &quot;vertical&quot;, &quot;editing&quot;: false, &quot;datasource&quot;: { &quot;id&quot;: &quot;518f590a-a4cc-446a-be85-b44efc8e4f6c&quot; } } ))
    &lt;/script&gt;--&gt;</span>
</code></pre>
<p>Now let&#x27;s change the entrypoint to the following:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=React!react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=ReactDOM!react-dom&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=ClientX!../src/components&quot;</span>;

<span class="hljs-keyword">const</span> bodyHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span>;
<span class="hljs-keyword">const</span> scriptTagExpression = <span class="hljs-regexp">/(?=&lt;!--&lt;script data-react-hydrate)([\s\S]*?)--&gt;/gm</span>;
<span class="hljs-keyword">const</span> scriptTagContentsExpression = <span class="hljs-regexp">/^&lt;!--|--&gt;$|&lt;script data-react-hydrate&gt;|&lt;\/script&gt;/g</span>;

<span class="hljs-keyword">const</span> matches = scriptTagExpression.<span class="hljs-title function_">exec</span>(bodyHtml);
matches?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> scriptTag = match.<span class="hljs-title function_">replace</span>(scriptTagContentsExpression, <span class="hljs-string">&quot;&quot;</span>);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-title class_">Function</span>(scriptTag)();
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;hydrating error:&quot;</span>, e, scriptTag);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;
});
</code></pre>
<p>With a regex we collect all the hydration scripts, and execute them by creating a function from the string and execute it directly. Now we can also move the reference to the client bundle to the bottom of the page as done <a href="https://www.erwinsmit.com/performancepoc/without-render-blockers.html">here</a>.</p>
<p>As a result, the Google Lighthouse warning is almost gone!</p>
<p><img src="/blog/lighthouse-no-render-blockers.jpg" alt="" title="Lighthouse almost happy"/></p>
<p>It&#x27;s still complaining about the css bundle blocking things, to fix that usually applying CSSPurge as discussed in a <a href="https://www.erwinsmit.com/make-your-sxa-site-perform/">previous blog post</a> is enough.</p>
<h2>Unused JavaScript</h2>
<p>As discussed above, the entrypoint imports all the components to be exported and exposed to the Window object. Because not all pages use the same set of components, you will always have a lot of unused JavaScript sitting on the page.
Google Lighthouse is not happy with this.</p>
<p><img src="/blog/lighthouse-unused-javascript.jpg" alt="" title="Google Lighthouse unused JavaScript"/></p>
<p>The suggestions from Google Lighthouse to look at &quot;React.lazy()&quot; or &quot;loadable-components&quot; are not useful for this type of React implementation. Because it&#x27;s no React application. It&#x27;s a couple of React components loaded separately on the page.
For fixing this we need to <strong>think outside of the React box</strong>. This problem can be tackled with the following steps:</p>
<ol>
<li>Find out which components are used on a page</li>
<li>Dynamically load these components using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import">dynamic imports</a></li>
<li>Expose the components on the window object</li>
</ol>
<h3>Find out which components are used on a page</h3>
<p>With more regex magic we can create a array with the component names used on the page.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> namespace = <span class="hljs-string">&quot;ClientX&quot;</span>;
<span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-title class_">String</span>.<span class="hljs-property">raw</span><span class="hljs-string">`<span class="hljs-subst">${namespace}</span>.default.+?(?=\W)`</span>, <span class="hljs-string">&quot;gm&quot;</span>);

<span class="hljs-keyword">const</span> bodyHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span>;
<span class="hljs-keyword">const</span> allComponents = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(bodyHtml.<span class="hljs-title function_">match</span>(regex))];
</code></pre>
<p>With the code above we grab all the components referenced in the inline script tags. With the &quot;new Set&quot; hack we remove all the duplicate keys.</p>
<p>Resulting in this array:</p>
<pre><code class="hljs language-javascript">[<span class="hljs-string">&quot;ClientX.default.Navigation&quot;</span>, <span class="hljs-string">&quot;ClientX.default.Section&quot;</span>, <span class="hljs-string">&quot;ClientX.default.HeroTeaser&quot;</span>, <span class="hljs-string">&quot;ClientX.default.USPHeader&quot;</span>];
</code></pre>
<h3>Dynamically load the components</h3>
<p>To allow the components to be dynamically loaded we need to change the way we currently create the index file for the components.</p>
<p>The old way:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Navigation</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./20_Molecules/NavigationMenu/container&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Section</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./02_Wrappers/structure/Section&#x27;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HeroTeaser</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./30_Organisms/HeroTeaser/container&#x27;</span>),
<span class="hljs-keyword">import</span> <span class="hljs-title class_">USPHeader</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./20_Molecules/Headers/USPHeader&#x27;</span>),
<span class="hljs-keyword">import</span> <span class="hljs-title class_">BannerTeaser</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./20_Molecules/Teasers/BannerTeaser&#x27;</span>)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
    <span class="hljs-title class_">Navigation</span>,
    <span class="hljs-title class_">Section</span>,
    <span class="hljs-title class_">HeroTeaser</span>,
    <span class="hljs-title class_">USPHeader</span>,
    <span class="hljs-title class_">BannerTeaser</span>
}
</code></pre>
<p>Instead, create a component loader object that adds a async function to every component key and add it to the client entrypoint:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> componentLoader = {
  <span class="hljs-title class_">Navigation</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/20_Molecules/NavigationMenu/container&quot;</span>),
  <span class="hljs-title class_">Section</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/02_Wrappers/structure/Section&quot;</span>),
  <span class="hljs-title class_">HeroTeaser</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/30_Organisms/HeroTeaser/container&quot;</span>),
  <span class="hljs-title class_">USPHeader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/20_Molecules/Headers/USPHeader&quot;</span>),
  <span class="hljs-title class_">BannerTeaser</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/20_Molecules/Teasers/BannerTeaser&quot;</span>),
};
</code></pre>
<p>Next, create an async function that loops over the &quot;allComponents&quot; array, load the imports and assigning them to the window object.</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactWindow</span> = <span class="hljs-title class_">Window</span> &amp; {
  [namespace]: {
    <span class="hljs-attr">default</span>: { [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> };
  };
};

<span class="hljs-keyword">const</span> reactWindow = <span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ReactWindow</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadComponents</span>(<span class="hljs-params"></span>) {
  reactWindow[namespace] = { <span class="hljs-attr">default</span>: {} };
  <span class="hljs-keyword">const</span> componentNamesExpression = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`<span class="hljs-subst">${namespace}</span>.default.+?(?=\\W)`</span>, <span class="hljs-string">&quot;gm&quot;</span>);

  <span class="hljs-keyword">const</span> allComponents = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(bodyHtml.<span class="hljs-title function_">match</span>(componentNamesExpression))];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">componentPromises</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">default</span>: <span class="hljs-built_in">any</span> }&gt;&gt; = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> allComponents) {
    <span class="hljs-keyword">const</span> componentsSplit = component.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);
    <span class="hljs-keyword">const</span> componentName = componentsSplit[componentsSplit.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> <span class="hljs-attr">componentPromise</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; = componentLoader[componentName];

    <span class="hljs-keyword">if</span> (componentPromise) {
      componentPromises.<span class="hljs-title function_">push</span>(componentPromise);
    }
  }

  <span class="hljs-keyword">const</span> tasks = componentPromises.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">task</span>) =&gt;</span> <span class="hljs-title function_">task</span>()); <span class="hljs-comment">// Run all the imports in parallel</span>
  <span class="hljs-keyword">const</span> components = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks); <span class="hljs-comment">// get the results</span>

  components.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">component, i</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> componentsSplit = allComponents[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);
    <span class="hljs-keyword">const</span> componentName = componentsSplit[componentsSplit.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];

    <span class="hljs-keyword">if</span> (component) {
      reactWindow[namespace].<span class="hljs-property">default</span>[componentName] = component.<span class="hljs-property">default</span>;
    }
  });
}
</code></pre>
<p>Now, if all is well, you will see a whole bunch of JavaScript files loaded in your requests instead of the one big bundle.</p>
<p><img src="/blog/codesplitting-requests.jpg" alt="" title="Code splitting requests"/></p>
<p>This is all great, and the amount of JavaScript loaded in total is already lower. But when running the <a href="https://www.npmjs.com/package/webpack-bundle-analyzer">webpack-bundle-analyzer</a> I noticed there is some duplicate code across the bundles.</p>
<p><img src="/blog/duplicate-code.jpg" alt="" title="Duplicate code"/></p>
<p>&quot;Icons.tsx&quot; and &quot;SafeRenderDatasourceComponent.tsx&quot; are included in multiple bundles. This is still better than having one big bundle as before but this can be easily fixed!</p>
<p>One way of achieving this is to dynamically load &quot;Icons.tsx&quot; in all the components, however this is error prone and it&#x27;s a lot of manual work.</p>
<p>My preference is to figure out which components are most likely re-used within a project and force these in a dedicated bundle. This can be done in the webpack configuration:</p>
<pre><code class="hljs language-javascript"><span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
        <span class="hljs-attr">cacheGroups</span>: {
            <span class="hljs-attr">atoms</span>: {
                <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;atoms&quot;</span>,
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]components[\\/]10_Atoms[\\/]/</span>,
                <span class="hljs-attr">enforce</span>: <span class="hljs-literal">true</span>
            },
            <span class="hljs-attr">hocs</span>: {
                <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;hocs&quot;</span>,
                <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]components[\\/]01_HOCs[\\/]/</span>,

            }
        }
    }
}
</code></pre>
<p>As a result the amount of JavaScript loaded has more than halved in size on most pages!</p>
<h3>Why is webpack not splitting the bundles?</h3>
<p>While working on a project that hasn&#x27;t updated for a while these things where stopping webpack from splitting the bundles:</p>
<ul>
<li>Old version of webpack</li>
<li>Old version of typescript</li>
<li>Deprecated loader &quot;awesome-typescript-loader&quot; was used, replace with <a href="ts-loader">https://github.com/TypeStrong/ts-loader</a></li>
<li>Module was not set to &quot;esnext&quot; in the tsconfig.json</li>
</ul>
<p>Fixing the items above already decreased the bundle size by quite a bit without code splitting. Probably by better treeshaking algorithms.</p>
<h2>The final code</h2>
<p>With the following code in your entrypoint you combine the best of both worlds. No more render blocking script tags and a lean and mean JavaScript bundle. Enjoy your fast new project!</p>
<pre><code class="hljs language-typescript"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=React!react&quot;</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;expose-loader?exposes=ReactDOM!react-dom&quot;</span>;

<span class="hljs-keyword">const</span> namespace = <span class="hljs-string">&quot;ClientX&quot;</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReactWindow</span> = <span class="hljs-title class_">Window</span> &amp; {
  [namespace]: {
    <span class="hljs-attr">default</span>: { [<span class="hljs-attr">key</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> };
  };
};

<span class="hljs-keyword">const</span> reactWindow = <span class="hljs-variable language_">window</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ReactWindow</span>;
<span class="hljs-keyword">const</span> bodyHtml = <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-property">innerHTML</span>;

<span class="hljs-keyword">const</span> componentLoader = {
  <span class="hljs-title class_">Navigation</span>: <span class="hljs-title function_">async</span> () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/20_Molecules/NavigationMenu/container&quot;</span>),
  <span class="hljs-title class_">Section</span>: <span class="hljs-title function_">async</span> () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/02_Wrappers/structure/Section&quot;</span>),
  <span class="hljs-title class_">HeroTeaser</span>: <span class="hljs-title function_">async</span> () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/30_Organisms/HeroTeaser/container&quot;</span>),
  <span class="hljs-title class_">USPHeader</span>: <span class="hljs-title function_">async</span> () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/20_Molecules/Headers/USPHeader&quot;</span>),
  <span class="hljs-title class_">VehicleGridContainer</span>: <span class="hljs-title function_">async</span> () =&gt; <span class="hljs-keyword">import</span>(<span class="hljs-string">&quot;../src/components/30_Organisms/VehicleGrid/VehicleGrid&quot;</span>),
};

<span class="hljs-comment">// 1. Only load the components that are present on the page</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadComponents</span>(<span class="hljs-params"></span>) {
  reactWindow[namespace] = { <span class="hljs-attr">default</span>: {} };
  <span class="hljs-keyword">const</span> componentNamesExpression = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">`<span class="hljs-subst">${namespace}</span>.default.+?(?=\\W)`</span>, <span class="hljs-string">&quot;gm&quot;</span>);

  <span class="hljs-keyword">const</span> allComponents = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(bodyHtml.<span class="hljs-title function_">match</span>(componentNamesExpression))];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">componentPromises</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">default</span>: <span class="hljs-built_in">any</span> }&gt;&gt; = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> allComponents) {
    <span class="hljs-keyword">const</span> componentsSplit = component.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);
    <span class="hljs-keyword">const</span> componentName = componentsSplit[componentsSplit.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">const</span> <span class="hljs-attr">componentPromise</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; = componentLoader[componentName];

    <span class="hljs-keyword">if</span> (componentPromise) {
      componentPromises.<span class="hljs-title function_">push</span>(componentPromise);
    }
  }

  <span class="hljs-keyword">const</span> tasks = componentPromises.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">task</span>) =&gt;</span> <span class="hljs-title function_">task</span>()); <span class="hljs-comment">// Run all the imports in parallel</span>
  <span class="hljs-keyword">const</span> components = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(tasks); <span class="hljs-comment">// get the results</span>

  components.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">component, i</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> componentsSplit = allComponents[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;.&quot;</span>);
    <span class="hljs-keyword">const</span> componentName = componentsSplit[componentsSplit.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];

    <span class="hljs-keyword">if</span> (component) {
      reactWindow[namespace].<span class="hljs-property">default</span>[componentName] = component.<span class="hljs-property">default</span>;
    }
  });
}

<span class="hljs-comment">// 2. Execute the react hydrate after the page is loaded...</span>
<span class="hljs-title function_">loadComponents</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> scriptTagExpression = <span class="hljs-regexp">/(?=&lt;!--&lt;script data-react-hydrate)([\s\S]*?)--&gt;/gm</span>;
  <span class="hljs-keyword">const</span> scriptTagContentsExpression = <span class="hljs-regexp">/^&lt;!--|--&gt;$|&lt;script data-react-hydrate&gt;|&lt;\/script&gt;/g</span>;

  <span class="hljs-keyword">const</span> matches = scriptTagExpression.<span class="hljs-title function_">exec</span>(bodyHtml);
  matches?.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">match</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> scriptTag = match.<span class="hljs-title function_">replace</span>(scriptTagContentsExpression, <span class="hljs-string">&quot;&quot;</span>);

    <span class="hljs-keyword">try</span> {
      <span class="hljs-title class_">Function</span>(scriptTag)();
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;hydrating error:&quot;</span>, e, scriptTag);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;
  });
});
</code></pre></div></article></main><section class="bg-gray-800 text-white py-12"><div class="container mx-auto px-4 text-center"><h2 class="text-2xl font-bold mb-6" id="connect">Connect With Me</h2><div class="flex justify-center space-x-6"><a href="https://github.com/erwinsmit" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg><span class="sr-only">GitHub</span></a><a href="https://www.linkedin.com/in/erwin-smit-40957840/" target="_blank" rel="noopener noreferrer" class="hover:text-blue-400 transition-colors"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect width="4" height="12" x="2" y="9"></rect><circle cx="4" cy="4" r="2"></circle></svg><span class="sr-only">LinkedIn</span></a></div></div></section><script src="/_next/static/chunks/webpack-8af1d2e0ff41d756.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"4:\"$Sreact.fragment\"\n5:I[7256,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"173\",\"static/chunks/173-e6c8bf506bfb93ff.js\",\"185\",\"static/chunks/app/layout-28f46ae9c6a8b2dc.js\"],\"default\"]\n6:I[9275,[],\"\"]\n7:I[1343,[],\"\"]\n8:I[4703,[\"231\",\"static/chunks/231-015614b9a59ae6eb.js\",\"160\",\"static/chunks/app/not-found-081a5836cd82c2ca.js\"],\"default\"]\na:I[3120,[],\"OutletBoundary\"]\nc:I[3120,[],\"MetadataBoundary\"]\ne:I[3120,[],\"ViewportBoundary\"]\n10:I[6130,[],\"\"]\n1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/0f5f8cc0eb7d6afc.css\",\"style\"]\n3:HL[\"/_next/static/css/3a398bc4ce4edcc7.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"x0Nx5fq_fUgZeHP0dlvsu\",\"p\":\"\",\"c\":[\"\",\"blog\",\"speed-up-your-sitecore-react-implementation\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"speed-up-your-sitecore-react-implementation\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"speed-up-your-sitecore-react-implementation\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$4\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0f5f8cc0eb7d6afc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/favicon/apple-touch-icon.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/favicon/favicon-32x32.png\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/favicon/favicon-16x16.png\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/favicon/site.webmanifest\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/favicon/safari-pinned-tab.svg\",\"color\":\"#000000\"}],[\"$\",\"link\",null,{\"rel\":\"shortcut icon\",\"href\":\"/favicon/favicon.ico\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#000000\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-config\",\"content\":\"/favicon/browserconfig.xml\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#000\"}],[\"$\",\"link\",null,{\"rel\":\"alternate\",\"type\":\"application/rss+xml\",\"href\":\"/feed.xml\"}]]}],[\"$\",\"body\",null,{\"className\":\"bg-gray-100 [object Object]\",\"children\":[[\"$\",\"$L5\",null,{}],[\"$\",\"main\",null,{\"className\":\"min-h-screen\",\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"$L8\",null,{}],\"notFoundStyles\":[]}]}],[\"$\",\"section\",null,{\"className\":\"bg-gray-800 text-white py-12\",\"children\":[\"$\",\"div\",null,{\"className\":\"container mx-auto px-4 text-center\",\"children\":[[\"$\",\"h2\",null,{\"className\":\"text-2xl font-bold mb-6\",\"id\":\"connect\",\"children\":\"Connect With Me\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-center space-x-6\",\"children\":[[\"$\",\"a\",null,{\"href\":\"https://github.com/erwinsmit\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-github\",\"children\":[[\"$\",\"path\",\"tonef\",{\"d\":\"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4\"}],[\"$\",\"path\",\"9comsn\",{\"d\":\"M9 18c-4.51 2-5-2-7-2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"GitHub\"}]]}],[\"$\",\"a\",null,{\"href\":\"https://www.linkedin.com/in/erwin-smit-40957840/\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"hover:text-blue-400 transition-colors\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-linkedin\",\"children\":[[\"$\",\"path\",\"c2jq9f\",{\"d\":\"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z\"}],[\"$\",\"rect\",\"mk3on5\",{\"width\":\"4\",\"height\":\"12\",\"x\":\"2\",\"y\":\"9\"}],[\"$\",\"circle\",\"bt5ra8\",{\"cx\":\"4\",\"cy\":\"4\",\"r\":\"2\"}],\"$undefined\"]}],[\"$\",\"span\",null,{\"className\":\"sr-only\",\"children\":\"LinkedIn\"}]]}]]}]]}]}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"speed-up-your-sitecore-react-implementation\",\"d\"],[\"$\",\"$4\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$4\",\"c\",{\"children\":[\"$L9\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/3a398bc4ce4edcc7.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"$La\",null,{\"children\":\"$Lb\"}]]}],{},null]},null]},null]},null],[\"$\",\"$4\",\"h\",{\"children\":[null,[\"$\",\"$4\",\"APiGvXyR5dG_onEeiIzUk\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"9:[\"$\",\"article\",null,{\"className\":\"max-w-7xl mx-auto px-8 my-12\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"w-full relative mb-8 text-6xl font-extrabold tracking-normal text-center title-font\",\"children\":[\"$\",\"span\",null,{\"className\":\"bg-clip-text text-transparent bg-gradient-to-b from-blue-600 to-blue-500\",\"children\":\"Speed up your Sitecore React implementation\"}]}],[\"$\",\"div\",null,{\"className\":\"flex items-center justify-center mb-16\",\"children\":[\"$\",\"p\",null,{\"className\":\"text-base font-medium text-gray-600 group-hover:text-gray-800\",\"children\":[\"$\",\"time\",null,{\"dateTime\":\"2021-02-11\",\"children\":\"February\\t11, 2021\"}]}]}],[\"$\",\"div\",null,{\"className\":\"prose lg:prose-xl max-w-none prose-pre:p-0\",\"children\":[[\"$\",\"p\",\"p-0\",{\"children\":[\"On a lot of Sitecore sites that jumped on the React bandwagon a while ago I notice some performance issues. In this post I will explain how to fix this and make your Sitecore/React implementation almost as fast as a site built with \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.erwinsmit.com/make-your-sxa-site-perform/\",\"children\":\"Stencil components\"}]]}],\"\\n\",[\"$\",\"p\",\"p-1\",{\"children\":[\"The two main issues with these websites are \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"Render blocking script tags\"}],\" and \",[\"$\",\"strong\",\"strong-1\",{\"children\":\"unused javascript\"}],\". Let's fix it!\"]}],\"\\n\",[\"$\",\"h2\",\"h2-0\",{\"children\":\"Render blocking script tags\"}],\"\\n\",[\"$\",\"p\",\"p-2\",{\"children\":[\"I created a static \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.erwinsmit.com/performancepoc/index.html\",\"children\":\"html page\"}],\" that reflects how many Sitecore sites work, it has inline script tags that refer to React components. Although these components are already rendered server side they still need to be \\\"Hydrated\\\". Hydration of a React component adds all the client side magic like event listeners, state changes, hooks etc.\"]}],\"\\n\",[\"$\",\"p\",\"p-3\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/hydration.jpg\",\"alt\":\"\",\"title\":\"Hydrate React component\"}]}],\"\\n\",[\"$\",\"p\",\"p-4\",{\"children\":[\"It's no exception to have about 20 of these inline script tags on the page to hydrate all the necessary React components. There are two issues with this approach. Every script tag that is not at the absolute bottom of the page \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"blocks the rendering\"}],\" of the HTML that follows, so the footer will not be rendered \",[\"$\",\"strong\",\"strong-1\",{\"children\":\"until\"}],\" the script tags in the main section are executed. The same applies for the rendering of the main section, this will not happen until the hydration of the header navigation is completed. For performance reasons this is not ideal, the HTML of the components is already server side rendered meaning that the user can see and interact with most of the HTML.\"]}],\"\\n\",[\"$\",\"p\",\"p-5\",{\"children\":[\"The \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"second issue\"}],\" with this approach is the dependency on global modules within the script tags, \\\"ClientX.default.Navigation\\\" needs to be registered on the Window object otherwise runtime exceptions will occur. Therefore the JavaScript bundle responsible for registering these components is at the top of the page. As a result the browser first needs to load and execute this script before it can render the HTML. You can imagine tools like Google Lighthouse are not happy with this!\"]}],\"\\n\",[\"$\",\"p\",\"p-6\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/lighthouse-not-happy.jpg\",\"alt\":\"\",\"title\":\"Lighthouse isn't happy!\"}]}],\"\\n\",[\"$\",\"h3\",\"h3-0\",{\"children\":\"How to fix this?\"}],\"\\n\",[\"$\",\"p\",\"p-7\",{\"children\":\"In the entrypoint for the client bundle the code usually looks like this:\"}],\"\\n\",[\"$\",\"pre\",\"pre-0\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=React!react\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=ReactDOM!react-dom\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=ClientX!../src/components\\\"\"}],\";\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-8\",{\"children\":\"React \u0026 ReactDOM are exposed to the window object and src/components refers to a entrypoint for all the components used within the sitecore rendering. That entrypoint is usually built up with a lot of imports and exports:\"}],\"\\n\",[\"$\",\"pre\",\"pre-1\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title class_\",\"children\":\"SearchResults\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"\\\"./30_Organisms/Blog/BlogPostsOverview\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-title class_\",\"children\":\"SearchBox\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-string\",\"children\":\"\\\"./30_Organisms/SearchBox/container\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title class_\",\"children\":\"BlogPostDetails\"}],\" \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-string\",\"children\":\"\\\"./30_Organisms/Blog/BlogPostDetails\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-title class_\",\"children\":\"Contact\"}],\" \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-string\",\"children\":\"\\\"./20_Molecules/Contact\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-title class_\",\"children\":\"NavigationSearchBox\"}],\" \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-string\",\"children\":\"\\\"./30_Organisms/SearchBox/variants/SimpleSearchBox\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-title class_\",\"children\":\"BannerTeaser\"}],\" \",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-string\",\"children\":\"\\\"./20_Molecules/Teasers/BannerTeaser\\\"\"}],\";\\n\\n\",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" {\\n  \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-title class_\",\"children\":\"BlockTeaser\"}],\",\\n  \",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-title class_\",\"children\":\"Button\"}],\",\\n  \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-variable constant_\",\"children\":\"FAQ\"}],\",\\n  \",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-title class_\",\"children\":\"FAQList\"}],\",\\n  \",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-title class_\",\"children\":\"NavigationImageList\"}],\",\\n  \",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-title class_\",\"children\":\"FooterMainImage\"}],\",\\n};\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-9\",{\"children\":\"This causes the components to be registered on the window object like \\\"window.ClientX.default.FAQ\\\"\"}],\"\\n\",[\"$\",\"p\",\"p-10\",{\"children\":[\"To fix the render blocking we first put HTML comments \",\" around all the hydration script. I also added a react-data-hydrate attribute so they are easily distinguishable from other inline scripts (e.g. Google tag manager).\"]}],\"\\n\",[\"$\",\"pre\",\"pre-2\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-html\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-comment\",\"children\":\"\u003c!--\u003cscript data-react-hydrate\u003e\\n        ReactDOM.hydrate(React.createElement(ClientX.default.Navigation, \\n        { \\\"module\\\": \\\"ClientX.default.Navigation\\\", \\\"id\\\": \\\"a2feda75-fd69-4811-962a-dd5411e3e7dd\\\", \\\"name\\\": \\\"Main Navigation\\\", \\\"variant\\\": \\\"vertical\\\", \\\"editing\\\": false, \\\"datasource\\\": { \\\"id\\\": \\\"518f590a-a4cc-446a-be85-b44efc8e4f6c\\\" } } ))\\n    \u003c/script\u003e--\u003e\"}],\"\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-11\",{\"children\":\"Now let's change the entrypoint to the following:\"}],\"\\n\",[\"$\",\"pre\",\"pre-3\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=React!react\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=ReactDOM!react-dom\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=ClientX!../src/components\\\"\"}],\";\\n\\n\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" bodyHtml = \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\";\\n\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTagExpression = \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-regexp\",\"children\":\"/(?=\u003c!--\u003cscript data-react-hydrate)([\\\\s\\\\S]*?)--\u003e/gm\"}],\";\\n\",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTagContentsExpression = \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-regexp\",\"children\":\"/^\u003c!--|--\u003e$|\u003cscript data-react-hydrate\u003e|\u003c\\\\/script\u003e/g\"}],\";\\n\\n\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" matches = scriptTagExpression.\",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-title function_\",\"children\":\"exec\"}],\"(bodyHtml);\\nmatches?.\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"match\"}],\") =\u003e\"]}],\" {\\n  \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTag = match.\",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-title function_\",\"children\":\"replace\"}],\"(scriptTagContentsExpression, \",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-string\",\"children\":\"\\\"\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n    \",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-title class_\",\"children\":\"Function\"}],\"(scriptTag)();\\n  } \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (e) {\\n    \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(\",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-string\",\"children\":\"\\\"hydrating error:\\\"\"}],\", e, scriptTag);\\n  }\\n  \",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-string\",\"children\":\"\\\"\\\"\"}],\";\\n});\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-12\",{\"children\":[\"With a regex we collect all the hydration scripts, and execute them by creating a function from the string and execute it directly. Now we can also move the reference to the client bundle to the bottom of the page as done \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.erwinsmit.com/performancepoc/without-render-blockers.html\",\"children\":\"here\"}],\".\"]}],\"\\n\",[\"$\",\"p\",\"p-13\",{\"children\":\"As a result, the Google Lighthouse warning is almost gone!\"}],\"\\n\",[\"$\",\"p\",\"p-14\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/lighthouse-no-render-blockers.jpg\",\"alt\":\"\",\"title\":\"Lighthouse almost happy\"}]}],\"\\n\",[\"$\",\"p\",\"p-15\",{\"children\":[\"It's still complaining about the css bundle blocking things, to fix that usually applying CSSPurge as discussed in a \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.erwinsmit.com/make-your-sxa-site-perform/\",\"children\":\"previous blog post\"}],\" is enough.\"]}],\"\\n\",[\"$\",\"h2\",\"h2-1\",{\"children\":\"Unused JavaScript\"}],\"\\n\",[\"$\",\"p\",\"p-16\",{\"children\":\"As discussed above, the entrypoint imports all the components to be exported and exposed to the Window object. Because not all pages use the same set of components, you will always have a lot of unused JavaScript sitting on the page.\\nGoogle Lighthouse is not happy with this.\"}],\"\\n\",[\"$\",\"p\",\"p-17\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/lighthouse-unused-javascript.jpg\",\"alt\":\"\",\"title\":\"Google Lighthouse unused JavaScript\"}]}],\"\\n\",[\"$\",\"p\",\"p-18\",{\"children\":[\"The suggestions from Google Lighthouse to look at \\\"React.lazy()\\\" or \\\"loadable-components\\\" are not useful for this type of React implementation. Because it's no React application. It's a couple of React components loaded separately on the page.\\nFor fixing this we need to \",[\"$\",\"strong\",\"strong-0\",{\"children\":\"think outside of the React box\"}],\". This problem can be tackled with the following steps:\"]}],\"\\n\",[\"$\",\"ol\",\"ol-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Find out which components are used on a page\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":[\"Dynamically load these components using \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\",\"children\":\"dynamic imports\"}]]}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":\"Expose the components on the window object\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",\"h3-1\",{\"children\":\"Find out which components are used on a page\"}],\"\\n\",[\"$\",\"p\",\"p-19\",{\"children\":\"With more regex magic we can create a array with the component names used on the page.\"}],\"\\n\",[\"$\",\"pre\",\"pre-4\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" namespace = \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" regex = \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-title class_\",\"children\":\"RegExp\"}],\"(\",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-title class_\",\"children\":\"String\"}],\".\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-property\",\"children\":\"raw\"}],[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"$${namespace}\"}],\".default.+?(?=\\\\W)`\"]}],\", \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-string\",\"children\":\"\\\"gm\\\"\"}],\");\\n\\n\",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" bodyHtml = \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\";\\n\",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" allComponents = [...\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-title class_\",\"children\":\"Set\"}],\"(bodyHtml.\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"match\"}],\"(regex))];\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-20\",{\"children\":\"With the code above we grab all the components referenced in the inline script tags. With the \\\"new Set\\\" hack we remove all the duplicate keys.\"}],\"\\n\",[\"$\",\"p\",\"p-21\",{\"children\":\"Resulting in this array:\"}],\"\\n\",[\"$\",\"pre\",\"pre-5\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[\"[\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX.default.Navigation\\\"\"}],\", \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX.default.Section\\\"\"}],\", \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX.default.HeroTeaser\\\"\"}],\", \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX.default.USPHeader\\\"\"}],\"];\\n\"]}]}],\"\\n\",[\"$\",\"h3\",\"h3-2\",{\"children\":\"Dynamically load the components\"}],\"\\n\",[\"$\",\"p\",\"p-22\",{\"children\":\"To allow the components to be dynamically loaded we need to change the way we currently create the index file for the components.\"}],\"\\n\",[\"$\",\"p\",\"p-23\",{\"children\":\"The old way:\"}],\"\\n\",[\"$\",\"pre\",\"pre-6\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title class_\",\"children\":\"Navigation\"}],\" \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"'./20_Molecules/NavigationMenu/container'\"}],\";\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-title class_\",\"children\":\"Section\"}],\" \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-string\",\"children\":\"'./02_Wrappers/structure/Section'\"}],\";\\n\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title class_\",\"children\":\"HeroTeaser\"}],\" \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-string\",\"children\":\"'./30_Organisms/HeroTeaser/container'\"}],\"),\\n\",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-title class_\",\"children\":\"USPHeader\"}],\" \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-string\",\"children\":\"'./20_Molecules/Headers/USPHeader'\"}],\"),\\n\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-title class_\",\"children\":\"BannerTeaser\"}],\" \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-keyword\",\"children\":\"from\"}],\" \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-string\",\"children\":\"'./20_Molecules/Teasers/BannerTeaser'\"}],\")\\n\\n\",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-keyword\",\"children\":\"default\"}],\" {\\n    \",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-title class_\",\"children\":\"Navigation\"}],\",\\n    \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-title class_\",\"children\":\"Section\"}],\",\\n    \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-title class_\",\"children\":\"HeroTeaser\"}],\",\\n    \",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-title class_\",\"children\":\"USPHeader\"}],\",\\n    \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-title class_\",\"children\":\"BannerTeaser\"}],\"\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-24\",{\"children\":\"Instead, create a component loader object that adds a async function to every component key and add it to the client entrypoint:\"}],\"\\n\",[\"$\",\"pre\",\"pre-7\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentLoader = {\\n  \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title class_\",\"children\":\"Navigation\"}],\": \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/20_Molecules/NavigationMenu/container\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-title class_\",\"children\":\"Section\"}],\": \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/02_Wrappers/structure/Section\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-title class_\",\"children\":\"HeroTeaser\"}],\": \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/30_Organisms/HeroTeaser/container\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-title class_\",\"children\":\"USPHeader\"}],\": \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/20_Molecules/Headers/USPHeader\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-title class_\",\"children\":\"BannerTeaser\"}],\": \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/20_Molecules/Teasers/BannerTeaser\\\"\"}],\"),\\n};\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-25\",{\"children\":\"Next, create an async function that loops over the \\\"allComponents\\\" array, load the imports and assigning them to the window object.\"}],\"\\n\",[\"$\",\"pre\",\"pre-8\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-title class_\",\"children\":\"ReactWindow\"}],\" = \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-title class_\",\"children\":\"Window\"}],\" \u0026 {\\n  [namespace]: {\\n    \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": { [\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"key\"}],\": \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\"]: \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-built_in\",\"children\":\"void\"}],\" };\\n  };\\n};\\n\\n\",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" reactWindow = \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\" \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-keyword\",\"children\":\"as\"}],\" \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-built_in\",\"children\":\"unknown\"}],\" \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-keyword\",\"children\":\"as\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-title class_\",\"children\":\"ReactWindow\"}],\";\\n\\n\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-title function_\",\"children\":\"loadComponents\"}],\"(\",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-params\"}],\") {\\n  reactWindow[namespace] = { \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": {} };\\n  \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentNamesExpression = \",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-title class_\",\"children\":\"RegExp\"}],\"(\",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"$${namespace}\"}],\".default.+?(?=\\\\\\\\W)`\"]}],\", \",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-string\",\"children\":\"\\\"gm\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" allComponents = [...\",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-title class_\",\"children\":\"Set\"}],\"(bodyHtml.\",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-title function_\",\"children\":\"match\"}],\"(componentNamesExpression))];\\n  \",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-attr\",\"children\":\"componentPromises\"}],\": \",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-title class_\",\"children\":\"Array\"}],\"\u003c\",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-32\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c{ \",[\"$\",\"span\",\"span-33\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": \",[\"$\",\"span\",\"span-34\",{\"className\":\"hljs-built_in\",\"children\":\"any\"}],\" }\u003e\u003e = [];\\n\\n  \",[\"$\",\"span\",\"span-35\",{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",\"span-36\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" component \",[\"$\",\"span\",\"span-37\",{\"className\":\"hljs-keyword\",\"children\":\"of\"}],\" allComponents) {\\n    \",[\"$\",\"span\",\"span-38\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentsSplit = component.\",[\"$\",\"span\",\"span-39\",{\"className\":\"hljs-title function_\",\"children\":\"split\"}],\"(\",[\"$\",\"span\",\"span-40\",{\"className\":\"hljs-string\",\"children\":\"\\\".\\\"\"}],\");\\n    \",[\"$\",\"span\",\"span-41\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentName = componentsSplit[componentsSplit.\",[\"$\",\"span\",\"span-42\",{\"className\":\"hljs-property\",\"children\":\"length\"}],\" - \",[\"$\",\"span\",\"span-43\",{\"className\":\"hljs-number\",\"children\":\"1\"}],\"];\\n    \",[\"$\",\"span\",\"span-44\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",\"span-45\",{\"className\":\"hljs-attr\",\"children\":\"componentPromise\"}],\": \",[\"$\",\"span\",\"span-46\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-47\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c\",[\"$\",\"span\",\"span-48\",{\"className\":\"hljs-built_in\",\"children\":\"any\"}],\"\u003e = componentLoader[componentName];\\n\\n    \",[\"$\",\"span\",\"span-49\",{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (componentPromise) {\\n      componentPromises.\",[\"$\",\"span\",\"span-50\",{\"className\":\"hljs-title function_\",\"children\":\"push\"}],\"(componentPromise);\\n    }\\n  }\\n\\n  \",[\"$\",\"span\",\"span-51\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" tasks = componentPromises.\",[\"$\",\"span\",\"span-52\",{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",\"span-53\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"task\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",\"span-54\",{\"className\":\"hljs-title function_\",\"children\":\"task\"}],\"()); \",[\"$\",\"span\",\"span-55\",{\"className\":\"hljs-comment\",\"children\":\"// Run all the imports in parallel\"}],\"\\n  \",[\"$\",\"span\",\"span-56\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" components = \",[\"$\",\"span\",\"span-57\",{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",\"span-58\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",\"span-59\",{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(tasks); \",[\"$\",\"span\",\"span-60\",{\"className\":\"hljs-comment\",\"children\":\"// get the results\"}],\"\\n\\n  components.\",[\"$\",\"span\",\"span-61\",{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",\"span-62\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"component, i\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",\"span-63\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentsSplit = allComponents[i].\",[\"$\",\"span\",\"span-64\",{\"className\":\"hljs-title function_\",\"children\":\"split\"}],\"(\",[\"$\",\"span\",\"span-65\",{\"className\":\"hljs-string\",\"children\":\"\\\".\\\"\"}],\");\\n    \",[\"$\",\"span\",\"span-66\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentName = componentsSplit[componentsSplit.\",[\"$\",\"span\",\"span-67\",{\"className\":\"hljs-property\",\"children\":\"length\"}],\" - \",[\"$\",\"span\",\"span-68\",{\"className\":\"hljs-number\",\"children\":\"1\"}],\"];\\n\\n    \",[\"$\",\"span\",\"span-69\",{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (component) {\\n      reactWindow[namespace].\",[\"$\",\"span\",\"span-70\",{\"className\":\"hljs-property\",\"children\":\"default\"}],\"[componentName] = component.\",[\"$\",\"span\",\"span-71\",{\"className\":\"hljs-property\",\"children\":\"default\"}],\";\\n    }\\n  });\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-26\",{\"children\":\"Now, if all is well, you will see a whole bunch of JavaScript files loaded in your requests instead of the one big bundle.\"}],\"\\n\",[\"$\",\"p\",\"p-27\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/codesplitting-requests.jpg\",\"alt\":\"\",\"title\":\"Code splitting requests\"}]}],\"\\n\",[\"$\",\"p\",\"p-28\",{\"children\":[\"This is all great, and the amount of JavaScript loaded in total is already lower. But when running the \",[\"$\",\"a\",\"a-0\",{\"href\":\"https://www.npmjs.com/package/webpack-bundle-analyzer\",\"children\":\"webpack-bundle-analyzer\"}],\" I noticed there is some duplicate code across the bundles.\"]}],\"\\n\",[\"$\",\"p\",\"p-29\",{\"children\":[\"$\",\"img\",\"img-0\",{\"src\":\"/blog/duplicate-code.jpg\",\"alt\":\"\",\"title\":\"Duplicate code\"}]}],\"\\n\",[\"$\",\"p\",\"p-30\",{\"children\":\"\\\"Icons.tsx\\\" and \\\"SafeRenderDatasourceComponent.tsx\\\" are included in multiple bundles. This is still better than having one big bundle as before but this can be easily fixed!\"}],\"\\n\",[\"$\",\"p\",\"p-31\",{\"children\":\"One way of achieving this is to dynamically load \\\"Icons.tsx\\\" in all the components, however this is error prone and it's a lot of manual work.\"}],\"\\n\",[\"$\",\"p\",\"p-32\",{\"children\":\"My preference is to figure out which components are most likely re-used within a project and force these in a dedicated bundle. This can be done in the webpack configuration:\"}],\"\\n\",[\"$\",\"pre\",\"pre-9\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-javascript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-attr\",\"children\":\"optimization\"}],\": {\\n    \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-attr\",\"children\":\"splitChunks\"}],\": {\\n        \",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-attr\",\"children\":\"cacheGroups\"}],\": {\\n            \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-attr\",\"children\":\"atoms\"}],\": {\\n                \",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-attr\",\"children\":\"name\"}],\": \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"\\\"atoms\\\"\"}],\",\\n                \",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-attr\",\"children\":\"test\"}],\": \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-regexp\",\"children\":\"/[\\\\\\\\/]components[\\\\\\\\/]10_Atoms[\\\\\\\\/]/\"}],\",\\n                \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-attr\",\"children\":\"enforce\"}],\": \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-literal\",\"children\":\"true\"}],\"\\n            },\\n            \",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-attr\",\"children\":\"hocs\"}],\": {\\n                \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-attr\",\"children\":\"name\"}],\": \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-string\",\"children\":\"\\\"hocs\\\"\"}],\",\\n                \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-attr\",\"children\":\"test\"}],\": \",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-regexp\",\"children\":\"/[\\\\\\\\/]components[\\\\\\\\/]01_HOCs[\\\\\\\\/]/\"}],\",\\n\\n            }\\n        }\\n    }\\n}\\n\"]}]}],\"\\n\",[\"$\",\"p\",\"p-33\",{\"children\":\"As a result the amount of JavaScript loaded has more than halved in size on most pages!\"}],\"\\n\",[\"$\",\"h3\",\"h3-3\",{\"children\":\"Why is webpack not splitting the bundles?\"}],\"\\n\",[\"$\",\"p\",\"p-34\",{\"children\":\"While working on a project that hasn't updated for a while these things where stopping webpack from splitting the bundles:\"}],\"\\n\",[\"$\",\"ul\",\"ul-0\",{\"children\":[\"\\n\",[\"$\",\"li\",\"li-0\",{\"children\":\"Old version of webpack\"}],\"\\n\",[\"$\",\"li\",\"li-1\",{\"children\":\"Old version of typescript\"}],\"\\n\",[\"$\",\"li\",\"li-2\",{\"children\":[\"Deprecated loader \\\"awesome-typescript-loader\\\" was used, replace with \",[\"$\",\"a\",\"a-0\",{\"href\":\"ts-loader\",\"children\":\"https://github.com/TypeStrong/ts-loader\"}]]}],\"\\n\",[\"$\",\"li\",\"li-3\",{\"children\":\"Module was not set to \\\"esnext\\\" in the tsconfig.json\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",\"p-35\",{\"children\":\"Fixing the items above already decreased the bundle size by quite a bit without code splitting. Probably by better treeshaking algorithms.\"}],\"\\n\",[\"$\",\"h2\",\"h2-2\",{\"children\":\"The final code\"}],\"\\n\",[\"$\",\"p\",\"p-36\",{\"children\":\"With the following code in your entrypoint you combine the best of both worlds. No more render blocking script tags and a lean and mean JavaScript bundle. Enjoy your fast new project!\"}],\"\\n\",[\"$\",\"pre\",\"pre-10\",{\"children\":[\"$\",\"code\",\"code-0\",{\"className\":\"hljs language-typescript\",\"children\":[[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-1\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=React!react\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-2\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\" \",[\"$\",\"span\",\"span-3\",{\"className\":\"hljs-string\",\"children\":\"\\\"expose-loader?exposes=ReactDOM!react-dom\\\"\"}],\";\\n\\n\",[\"$\",\"span\",\"span-4\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" namespace = \",[\"$\",\"span\",\"span-5\",{\"className\":\"hljs-string\",\"children\":\"\\\"ClientX\\\"\"}],\";\\n\",[\"$\",\"span\",\"span-6\",{\"className\":\"hljs-keyword\",\"children\":\"type\"}],\" \",[\"$\",\"span\",\"span-7\",{\"className\":\"hljs-title class_\",\"children\":\"ReactWindow\"}],\" = \",[\"$\",\"span\",\"span-8\",{\"className\":\"hljs-title class_\",\"children\":\"Window\"}],\" \u0026 {\\n  [namespace]: {\\n    \",[\"$\",\"span\",\"span-9\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": { [\",[\"$\",\"span\",\"span-10\",{\"className\":\"hljs-attr\",\"children\":\"key\"}],\": \",[\"$\",\"span\",\"span-11\",{\"className\":\"hljs-built_in\",\"children\":\"string\"}],\"]: \",[\"$\",\"span\",\"span-12\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-13\",{\"className\":\"hljs-built_in\",\"children\":\"void\"}],\" };\\n  };\\n};\\n\\n\",[\"$\",\"span\",\"span-14\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" reactWindow = \",[\"$\",\"span\",\"span-15\",{\"className\":\"hljs-variable language_\",\"children\":\"window\"}],\" \",[\"$\",\"span\",\"span-16\",{\"className\":\"hljs-keyword\",\"children\":\"as\"}],\" \",[\"$\",\"span\",\"span-17\",{\"className\":\"hljs-built_in\",\"children\":\"unknown\"}],\" \",[\"$\",\"span\",\"span-18\",{\"className\":\"hljs-keyword\",\"children\":\"as\"}],\" \",[\"$\",\"span\",\"span-19\",{\"className\":\"hljs-title class_\",\"children\":\"ReactWindow\"}],\";\\n\",[\"$\",\"span\",\"span-20\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" bodyHtml = \",[\"$\",\"span\",\"span-21\",{\"className\":\"hljs-variable language_\",\"children\":\"document\"}],\".\",[\"$\",\"span\",\"span-22\",{\"className\":\"hljs-property\",\"children\":\"body\"}],\".\",[\"$\",\"span\",\"span-23\",{\"className\":\"hljs-property\",\"children\":\"innerHTML\"}],\";\\n\\n\",[\"$\",\"span\",\"span-24\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentLoader = {\\n  \",[\"$\",\"span\",\"span-25\",{\"className\":\"hljs-title class_\",\"children\":\"Navigation\"}],\": \",[\"$\",\"span\",\"span-26\",{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" () =\u003e \",[\"$\",\"span\",\"span-27\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-28\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/20_Molecules/NavigationMenu/container\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-29\",{\"className\":\"hljs-title class_\",\"children\":\"Section\"}],\": \",[\"$\",\"span\",\"span-30\",{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" () =\u003e \",[\"$\",\"span\",\"span-31\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-32\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/02_Wrappers/structure/Section\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-33\",{\"className\":\"hljs-title class_\",\"children\":\"HeroTeaser\"}],\": \",[\"$\",\"span\",\"span-34\",{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" () =\u003e \",[\"$\",\"span\",\"span-35\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-36\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/30_Organisms/HeroTeaser/container\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-37\",{\"className\":\"hljs-title class_\",\"children\":\"USPHeader\"}],\": \",[\"$\",\"span\",\"span-38\",{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" () =\u003e \",[\"$\",\"span\",\"span-39\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-40\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/20_Molecules/Headers/USPHeader\\\"\"}],\"),\\n  \",[\"$\",\"span\",\"span-41\",{\"className\":\"hljs-title class_\",\"children\":\"VehicleGridContainer\"}],\": \",[\"$\",\"span\",\"span-42\",{\"className\":\"hljs-title function_\",\"children\":\"async\"}],\" () =\u003e \",[\"$\",\"span\",\"span-43\",{\"className\":\"hljs-keyword\",\"children\":\"import\"}],\"(\",[\"$\",\"span\",\"span-44\",{\"className\":\"hljs-string\",\"children\":\"\\\"../src/components/30_Organisms/VehicleGrid/VehicleGrid\\\"\"}],\"),\\n};\\n\\n\",[\"$\",\"span\",\"span-45\",{\"className\":\"hljs-comment\",\"children\":\"// 1. Only load the components that are present on the page\"}],\"\\n\",[\"$\",\"span\",\"span-46\",{\"className\":\"hljs-keyword\",\"children\":\"async\"}],\" \",[\"$\",\"span\",\"span-47\",{\"className\":\"hljs-keyword\",\"children\":\"function\"}],\" \",[\"$\",\"span\",\"span-48\",{\"className\":\"hljs-title function_\",\"children\":\"loadComponents\"}],\"(\",[\"$\",\"span\",\"span-49\",{\"className\":\"hljs-params\"}],\") {\\n  reactWindow[namespace] = { \",[\"$\",\"span\",\"span-50\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": {} };\\n  \",[\"$\",\"span\",\"span-51\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentNamesExpression = \",[\"$\",\"span\",\"span-52\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-53\",{\"className\":\"hljs-title class_\",\"children\":\"RegExp\"}],\"(\",[\"$\",\"span\",\"span-54\",{\"className\":\"hljs-string\",\"children\":[\"`\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-subst\",\"children\":\"$${namespace}\"}],\".default.+?(?=\\\\\\\\W)`\"]}],\", \",[\"$\",\"span\",\"span-55\",{\"className\":\"hljs-string\",\"children\":\"\\\"gm\\\"\"}],\");\\n\\n  \",[\"$\",\"span\",\"span-56\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" allComponents = [...\",[\"$\",\"span\",\"span-57\",{\"className\":\"hljs-keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",\"span-58\",{\"className\":\"hljs-title class_\",\"children\":\"Set\"}],\"(bodyHtml.\",[\"$\",\"span\",\"span-59\",{\"className\":\"hljs-title function_\",\"children\":\"match\"}],\"(componentNamesExpression))];\\n  \",[\"$\",\"span\",\"span-60\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",\"span-61\",{\"className\":\"hljs-attr\",\"children\":\"componentPromises\"}],\": \",[\"$\",\"span\",\"span-62\",{\"className\":\"hljs-title class_\",\"children\":\"Array\"}],\"\u003c\",[\"$\",\"span\",\"span-63\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-64\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c{ \",[\"$\",\"span\",\"span-65\",{\"className\":\"hljs-attr\",\"children\":\"default\"}],\": \",[\"$\",\"span\",\"span-66\",{\"className\":\"hljs-built_in\",\"children\":\"any\"}],\" }\u003e\u003e = [];\\n\\n  \",[\"$\",\"span\",\"span-67\",{\"className\":\"hljs-keyword\",\"children\":\"for\"}],\" (\",[\"$\",\"span\",\"span-68\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" component \",[\"$\",\"span\",\"span-69\",{\"className\":\"hljs-keyword\",\"children\":\"of\"}],\" allComponents) {\\n    \",[\"$\",\"span\",\"span-70\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentsSplit = component.\",[\"$\",\"span\",\"span-71\",{\"className\":\"hljs-title function_\",\"children\":\"split\"}],\"(\",[\"$\",\"span\",\"span-72\",{\"className\":\"hljs-string\",\"children\":\"\\\".\\\"\"}],\");\\n    \",[\"$\",\"span\",\"span-73\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentName = componentsSplit[componentsSplit.\",[\"$\",\"span\",\"span-74\",{\"className\":\"hljs-property\",\"children\":\"length\"}],\" - \",[\"$\",\"span\",\"span-75\",{\"className\":\"hljs-number\",\"children\":\"1\"}],\"];\\n    \",[\"$\",\"span\",\"span-76\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" \",[\"$\",\"span\",\"span-77\",{\"className\":\"hljs-attr\",\"children\":\"componentPromise\"}],\": \",[\"$\",\"span\",\"span-78\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" \",[\"$\",\"span\",\"span-79\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\"\u003c\",[\"$\",\"span\",\"span-80\",{\"className\":\"hljs-built_in\",\"children\":\"any\"}],\"\u003e = componentLoader[componentName];\\n\\n    \",[\"$\",\"span\",\"span-81\",{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (componentPromise) {\\n      componentPromises.\",[\"$\",\"span\",\"span-82\",{\"className\":\"hljs-title function_\",\"children\":\"push\"}],\"(componentPromise);\\n    }\\n  }\\n\\n  \",[\"$\",\"span\",\"span-83\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" tasks = componentPromises.\",[\"$\",\"span\",\"span-84\",{\"className\":\"hljs-title function_\",\"children\":\"map\"}],\"(\",[\"$\",\"span\",\"span-85\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"task\"}],\") =\u003e\"]}],\" \",[\"$\",\"span\",\"span-86\",{\"className\":\"hljs-title function_\",\"children\":\"task\"}],\"()); \",[\"$\",\"span\",\"span-87\",{\"className\":\"hljs-comment\",\"children\":\"// Run all the imports in parallel\"}],\"\\n  \",[\"$\",\"span\",\"span-88\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" components = \",[\"$\",\"span\",\"span-89\",{\"className\":\"hljs-keyword\",\"children\":\"await\"}],\" \",[\"$\",\"span\",\"span-90\",{\"className\":\"hljs-title class_\",\"children\":\"Promise\"}],\".\",[\"$\",\"span\",\"span-91\",{\"className\":\"hljs-title function_\",\"children\":\"all\"}],\"(tasks); \",[\"$\",\"span\",\"span-92\",{\"className\":\"hljs-comment\",\"children\":\"// get the results\"}],\"\\n\\n  components.\",[\"$\",\"span\",\"span-93\",{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",\"span-94\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"component, i\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",\"span-95\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentsSplit = allComponents[i].\",[\"$\",\"span\",\"span-96\",{\"className\":\"hljs-title function_\",\"children\":\"split\"}],\"(\",[\"$\",\"span\",\"span-97\",{\"className\":\"hljs-string\",\"children\":\"\\\".\\\"\"}],\");\\n    \",[\"$\",\"span\",\"span-98\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" componentName = componentsSplit[componentsSplit.\",[\"$\",\"span\",\"span-99\",{\"className\":\"hljs-property\",\"children\":\"length\"}],\" - \",[\"$\",\"span\",\"span-100\",{\"className\":\"hljs-number\",\"children\":\"1\"}],\"];\\n\\n    \",[\"$\",\"span\",\"span-101\",{\"className\":\"hljs-keyword\",\"children\":\"if\"}],\" (component) {\\n      reactWindow[namespace].\",[\"$\",\"span\",\"span-102\",{\"className\":\"hljs-property\",\"children\":\"default\"}],\"[componentName] = component.\",[\"$\",\"span\",\"span-103\",{\"className\":\"hljs-property\",\"children\":\"default\"}],\";\\n    }\\n  });\\n}\\n\\n\",[\"$\",\"span\",\"span-104\",{\"className\":\"hljs-comment\",\"children\":\"// 2. Execute the react hydrate after the page is loaded...\"}],\"\\n\",[\"$\",\"span\",\"span-105\",{\"className\":\"hljs-title function_\",\"children\":\"loadComponents\"}],\"().\",[\"$\",\"span\",\"span-106\",{\"className\":\"hljs-title function_\",\"children\":\"then\"}],\"(\",[\"$\",\"span\",\"span-107\",{\"className\":\"hljs-function\",\"children\":\"() =\u003e\"}],\" {\\n  \",[\"$\",\"span\",\"span-108\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTagExpression = \",[\"$\",\"span\",\"span-109\",{\"className\":\"hljs-regexp\",\"children\":\"/(?=\u003c!--\u003cscript data-react-hydrate)([\\\\s\\\\S]*?)--\u003e/gm\"}],\";\\n  \",[\"$\",\"span\",\"span-110\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTagContentsExpression = \",[\"$\",\"span\",\"span-111\",{\"className\":\"hljs-regexp\",\"children\":\"/^\u003c!--|--\u003e$|\u003cscript data-react-hydrate\u003e|\u003c\\\\/script\u003e/g\"}],\";\\n\\n  \",[\"$\",\"span\",\"span-112\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" matches = scriptTagExpression.\",[\"$\",\"span\",\"span-113\",{\"className\":\"hljs-title function_\",\"children\":\"exec\"}],\"(bodyHtml);\\n  matches?.\",[\"$\",\"span\",\"span-114\",{\"className\":\"hljs-title function_\",\"children\":\"forEach\"}],\"(\",[\"$\",\"span\",\"span-115\",{\"className\":\"hljs-function\",\"children\":[\"(\",[\"$\",\"span\",\"span-0\",{\"className\":\"hljs-params\",\"children\":\"match\"}],\") =\u003e\"]}],\" {\\n    \",[\"$\",\"span\",\"span-116\",{\"className\":\"hljs-keyword\",\"children\":\"const\"}],\" scriptTag = match.\",[\"$\",\"span\",\"span-117\",{\"className\":\"hljs-title function_\",\"children\":\"replace\"}],\"(scriptTagContentsExpression, \",[\"$\",\"span\",\"span-118\",{\"className\":\"hljs-string\",\"children\":\"\\\"\\\"\"}],\");\\n\\n    \",[\"$\",\"span\",\"span-119\",{\"className\":\"hljs-keyword\",\"children\":\"try\"}],\" {\\n      \",[\"$\",\"span\",\"span-120\",{\"className\":\"hljs-title class_\",\"children\":\"Function\"}],\"(scriptTag)();\\n    } \",[\"$\",\"span\",\"span-121\",{\"className\":\"hljs-keyword\",\"children\":\"catch\"}],\" (e) {\\n      \",[\"$\",\"span\",\"span-122\",{\"className\":\"hljs-variable language_\",\"children\":\"console\"}],\".\",[\"$\",\"span\",\"span-123\",{\"className\":\"hljs-title function_\",\"children\":\"error\"}],\"(\",[\"$\",\"span\",\"span-124\",{\"className\":\"hljs-string\",\"children\":\"\\\"hydrating error:\\\"\"}],\", e, scriptTag);\\n    }\\n    \",[\"$\",\"span\",\"span-125\",{\"className\":\"hljs-keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",\"span-126\",{\"className\":\"hljs-string\",\"children\":\"\\\"\\\"\"}],\";\\n  });\\n});\\n\"]}]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"Speed up your Sitecore React implementation\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"Speed up your Sitecore React implementation\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:title\",\"content\":\"Speed up your Sitecore React implementation\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:description\",\"content\":\"Erwin Smit - Freelance frontend developer / fullstack developer\"}]]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script></body></html>