{"componentChunkName":"component---src-templates-blog-post-js","path":"/ordercloud-sitecore-jss-nextjs/","webpackCompilationHash":"ede76a792a504e8ab63a","result":{"data":{"site":{"siteMetadata":{"title":"Erwin Smit blog","author":"Erwin Smit"}},"markdownRemark":{"id":"c856f4c6-ecbe-5500-8234-6ed27130b120","html":"<p>In this blog post, I like to explain how easy it is to add some products from OrderCloud to a pre-rendered page in Sitecore JSS using Next.js</p>\n<h2 id=\"first-make-a-storefront\"><a href=\"#first-make-a-storefront\" aria-label=\"first make a storefront permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>First, make a storefront</h2>\n<p>To be able to do this you need to create an OrderCloud marketplace and have some products.\nI created a free OrderCloud account and ran these commands to automatically create a marketplace filled with products and facets:</p>\n<ul>\n<li><code class=\"language-text\">npm i @ordercloud/seeding -g</code></li>\n<li><code class=\"language-text\">seed https://raw.githubusercontent.com/ordercloud-api/ordercloud-seed/main/seeds/Simple-B2C.yml -u={username} -p={password</code></li>\n</ul>\n<p>Next, log in to your marketplace and make a note of the Storefront App ID:\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f5775db06778956dec6901f01da21aa/eab05/api-key.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 900px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 62.172949002217294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAdxYJk//xAAWEAEBAQAAAAAAAAAAAAAAAAAAESD/2gAIAQEAAQUCxEf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAADAQEAAAAAAAAAAAAAAAAAAREhEP/aAAgBAQABPyGRcui1EEH/2gAMAwEAAgADAAAAEPP/AP/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAAh/9oACAECAQE/EEf/xAAdEAACAgIDAQAAAAAAAAAAAAAAASExEUFRYZGh/9oACAEBAAE/EEu+yFr6XLFPFiQPkgxPp0H/2Q=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Storefront App ID\"\n        title=\"\"\n        src=\"/static/5f5775db06778956dec6901f01da21aa/2a9fa/api-key.jpg\"\n        srcset=\"/static/5f5775db06778956dec6901f01da21aa/f0518/api-key.jpg 225w,\n/static/5f5775db06778956dec6901f01da21aa/b3492/api-key.jpg 450w,\n/static/5f5775db06778956dec6901f01da21aa/2a9fa/api-key.jpg 900w,\n/static/5f5775db06778956dec6901f01da21aa/987c3/api-key.jpg 1350w,\n/static/5f5775db06778956dec6901f01da21aa/e2107/api-key.jpg 1800w,\n/static/5f5775db06778956dec6901f01da21aa/eab05/api-key.jpg 2255w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n      />\n  </span>\n  </a></p>\n<p>Add this ID along with these OrderCloud variables to the .env file in the root of your JSS Next.js project:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">NEXT_PUBLIC_OC_CLIENT_ID={AddYourStorefrontAppIdHere}\nNEXT_PUBLIC_OC_SCOPE=Shopper,MeAddressAdmin\nNEXT_PUBLIC_OC_BASE_API_URL=https://sandboxapi.ordercloud.io\nNEXT_PUBLIC_OC_ALLOW_ANONYMOUS=false</code></pre></div>\n<h2 id=\"initialise-ordercloud-in-your-app\"><a href=\"#initialise-ordercloud-in-your-app\" aria-label=\"initialise ordercloud in your app permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Initialise OrderCloud in your app</h2>\n<p>In the _app.tsx add the following code to create a connection to Ordercloud using the Ordercloud Javascript SDK:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Configuration<span class=\"token punctuation\">,</span> Tokens<span class=\"token punctuation\">,</span> Auth <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ordercloud-javascript-sdk\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> clientId <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_OC_CLIENT_ID</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> baseApiUrl <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_OC_BASE_API_URL</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> scope <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">NEXT_PUBLIC_OC_SCOPE</span><span class=\"token operator\">?</span><span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    Configuration<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      clientID<span class=\"token punctuation\">:</span> clientId<span class=\"token punctuation\">,</span>\n      baseApiUrl<span class=\"token punctuation\">:</span> baseApiUrl<span class=\"token punctuation\">,</span>\n      cookieOptions<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> prefix<span class=\"token punctuation\">:</span> <span class=\"token string\">\"hds-nextjs\"</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">:</span> <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">const</span> authResponse <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Auth<span class=\"token punctuation\">.</span><span class=\"token function\">Anonymous</span><span class=\"token punctuation\">(</span>clientId<span class=\"token punctuation\">,</span> scope <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> ApiRole<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    Tokens<span class=\"token punctuation\">.</span><span class=\"token function\">SetAccessToken</span><span class=\"token punctuation\">(</span>authResponse<span class=\"token punctuation\">.</span>access_token<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Now you have access to all the OrderCloud stuff throughout your application. If you only need OrderCloud on a specific set of routes, consider moving this logic somewhere else. </p>\n<p>To display some products with an active facet pre-selected I have created a simple Sitecore component where the facet is set in the Sitecore admin. Component definition:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">manifest<span class=\"token punctuation\">:</span> Manifest</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  manifest<span class=\"token punctuation\">.</span><span class=\"token function\">addComponent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ProductList\"</span><span class=\"token punctuation\">,</span>\n    icon<span class=\"token punctuation\">:</span> SitecoreIcon<span class=\"token punctuation\">.</span>DocumentTag<span class=\"token punctuation\">,</span>\n    fields<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"colorfacet\"</span><span class=\"token punctuation\">,</span> type<span class=\"token punctuation\">:</span> CommonFieldTypes<span class=\"token punctuation\">.</span>SingleLineText <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"get-the-products\"><a href=\"#get-the-products\" aria-label=\"get the products permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get the products</h2>\n<p>In the actual component implementation, the products are fetched using the <code class=\"language-text\">Me.ListProducts</code> function. To inject the data into the component return the response in <code class=\"language-text\">getStaticProps</code>. Now the data is available within the component using <code class=\"language-text\">useComponentProps</code>.</p>\n<p>See the code below for an example:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  ListPageWithFacets<span class=\"token punctuation\">,</span>\n  Me<span class=\"token punctuation\">,</span>\n  RequiredDeep<span class=\"token punctuation\">,</span>\n  BuyerProduct\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"ordercloud-javascript-sdk\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ProductList<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token constant\">FC</span><span class=\"token operator\">&lt;</span>ProductListProps<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> rendering<span class=\"token punctuation\">,</span> fields <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">JSX</span><span class=\"token punctuation\">.</span><span class=\"token parameter\">Element</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> useComponentProps<span class=\"token operator\">&lt;</span>RequiredDeep<span class=\"token operator\">&lt;</span>ListPageWithFacets<span class=\"token operator\">&lt;</span>BuyerProduct<span class=\"token operator\">>>></span><span class=\"token punctuation\">(</span>rendering<span class=\"token punctuation\">.</span>uid<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> getStaticProps<span class=\"token punctuation\">:</span> <span class=\"token function-variable function\">GetStaticComponentProps</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">rendering</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Me<span class=\"token punctuation\">.</span><span class=\"token function\">ListProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      filters<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"xp.Facets.Color\"</span><span class=\"token punctuation\">:</span> rendering<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>colorfacet<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> ProductList<span class=\"token punctuation\">;</span></code></pre></div>\n<p>As a result, we now have products from our OrderCloud marketplace rendered on Next.js build-time. Fast and good for SEO!</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3759a4bc175b29bfd22c564ad179144e/76f1c/ordercloud-products.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 900px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABA//EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAWq6aFlR/8QAGxABAAICAwAAAAAAAAAAAAAAAgEDERIhMkH/2gAIAQEAAQUCVyMFqYpu3GOPT1//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAbEAABBQEBAAAAAAAAAAAAAAARAAECITEQIv/aAAgBAQAGPwKfnFGQoF0XYWtdbz//xAAaEAADAQEBAQAAAAAAAAAAAAAAARExIUFh/9oACAEBAAE/IWsvjfSDNbBzq1LhdbXeDXTrMHbSus//2gAMAwEAAgADAAAAEJPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQADAQEBAAAAAAAAAAAAAREAITFRYZH/2gAIAQEAAT8QrNRuEFZ+ZtAemwzh7g7xguQ5mrCVQUHnOYoeOprD7y4x0DbO5//Z'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"OrderCloud products\"\n        title=\"\"\n        src=\"/static/3759a4bc175b29bfd22c564ad179144e/2a9fa/ordercloud-products.jpg\"\n        srcset=\"/static/3759a4bc175b29bfd22c564ad179144e/f0518/ordercloud-products.jpg 225w,\n/static/3759a4bc175b29bfd22c564ad179144e/b3492/ordercloud-products.jpg 450w,\n/static/3759a4bc175b29bfd22c564ad179144e/2a9fa/ordercloud-products.jpg 900w,\n/static/3759a4bc175b29bfd22c564ad179144e/987c3/ordercloud-products.jpg 1350w,\n/static/3759a4bc175b29bfd22c564ad179144e/e2107/ordercloud-products.jpg 1800w,\n/static/3759a4bc175b29bfd22c564ad179144e/76f1c/ordercloud-products.jpg 2601w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n      />\n  </span>\n  </a></p>","timeToRead":2,"frontmatter":{"title":"Integrate OrderCloud with Sitecore JSS Next.js","date":"November 27, 2021","spoiler":"One way of doing this"},"fields":{"slug":"/ordercloud-sitecore-jss-nextjs/","langKey":"en"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/ordercloud-sitecore-jss-nextjs/","previous":{"fields":{"slug":"/add-external-datasource-to-sitecore-jss/","langKey":"en","directoryName":"add-external-datasource-to-sitecore-jss"},"frontmatter":{"title":"Add external datasource to Sitecore JSS"}},"next":{"fields":{"slug":"/can-we-keep-up-with-vercel/","langKey":"en","directoryName":"can-we-keep-up-with-vercel"},"frontmatter":{"title":"Can we keep up with Vercel?"}},"translations":[],"translatedLinks":[]}}}