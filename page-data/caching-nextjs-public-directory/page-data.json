{"componentChunkName":"component---src-templates-blog-post-js","path":"/caching-nextjs-public-directory/","webpackCompilationHash":"04c6abd57795f98d1695","result":{"data":{"site":{"siteMetadata":{"title":"Erwin Smit blog","author":"Erwin Smit"}},"markdownRemark":{"id":"e2bbde29-3f50-588d-812b-d5fc1abbeca3","html":"<p>By default assets from the public directory have no cache headers set. Usually you have assets that never change and are quite large in this directory. In a recent project I noticed that our font files were loaded on each browser request. As shown in the screenshot there is no cache header on the font file.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a28f633640378b82d35ebbc2d3a11481/ad211/no-cache-header.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 900px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 17.883211678832115%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAl0lEQVQI133MSwrCMBgE4Nz/GqL2DC4VigcQxIWoYEjSpEn615B3YtudKA4fs5jFIN0TLZkzqkTzUwoGU35/EsI6whideyakROs92xxY08rmaLafpmXVvnYnqzV0nXDOpZRijDnnUkqtFd1EmVx5vtD07UzSo88wAMaYc6H1ADBaa733IQRU/6YsDQCEUCGEUmoE0NPHkje+k95zN9VvogAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"No cache header\"\n        title=\"\"\n        src=\"/static/a28f633640378b82d35ebbc2d3a11481/05649/no-cache-header.png\"\n        srcset=\"/static/a28f633640378b82d35ebbc2d3a11481/e9d1c/no-cache-header.png 225w,\n/static/a28f633640378b82d35ebbc2d3a11481/80b02/no-cache-header.png 450w,\n/static/a28f633640378b82d35ebbc2d3a11481/05649/no-cache-header.png 900w,\n/static/a28f633640378b82d35ebbc2d3a11481/572e0/no-cache-header.png 1350w,\n/static/a28f633640378b82d35ebbc2d3a11481/b501b/no-cache-header.png 1800w,\n/static/a28f633640378b82d35ebbc2d3a11481/ad211/no-cache-header.png 2466w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n      />\n  </span>\n  </a></p>\n<p>This is easily solved by adding header configuration to your <strong>next.config.js</strong> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"> <span class=\"token keyword\">async</span> <span class=\"token function\">headers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            source<span class=\"token punctuation\">:</span> <span class=\"token string\">'/fonts/(.*)'</span><span class=\"token punctuation\">,</span>\n            headers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token punctuation\">{</span> \n                    key<span class=\"token punctuation\">:</span> <span class=\"token string\">'Cache-Control'</span><span class=\"token punctuation\">,</span>\n                    value<span class=\"token punctuation\">:</span> <span class=\"token string\">'public, max-age=31536000, stale-while-revalidate'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>A font file never changes and is usually quite large, so this will save a lot of bandwidth!</p>","timeToRead":1,"frontmatter":{"title":"Add caching to Sitecore JSS Next.js public directory","date":"January 08, 2023","spoiler":"By default assets from the public directory have no cache headers set. Usually you have assets that never change and are quite large in this directory. It's worth fixing this."},"fields":{"slug":"/caching-nextjs-public-directory/","langKey":"en"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/caching-nextjs-public-directory/","previous":{"fields":{"slug":"/multiline-transition/","langKey":"en","directoryName":"multiline-transition"},"frontmatter":{"title":"Multiline underline transition"}},"next":{"fields":{"slug":"/block-automatically-generated-domain-azure-swa/","langKey":"en","directoryName":"block-automatically-generated-domain-azure-swa"},"frontmatter":{"title":"Block generated domains by Azure Static Web Apps"}},"translations":[],"translatedLinks":[]}}}